"use strict";

var INCOME = 60000,
    DEDUCTIBLE = 5000,
    PREMIUM = 600,
    EMPLOYED = true;

var currentMonthly = DEDUCTIBLE / 12 + PREMIUM;
var padding = 5;

$(function () {

  var computeContribution = function computeContribution(d) {
    if (d < 25000) {
      return 0;
    } else if (d >= 25000 && d < 50000) {
      return (d - 25000) * 0.09 / 12;
    } else if (d >= 50000 && d < 75000) {
      return (d - 25000) * 0.11 / 12;
    } else if (d >= 75000 && d < 100000) {
      return (d - 25000) * 0.12 / 12;
    } else if (d >= 100000 && d < 200000) {
      return (d - 25000) * 0.14 / 12;
    } else {
      return (d - 25000) * 0.16 / 12;
    }
  };

  var computeEmployerContrib = function computeEmployerContrib(d) {
    return computeContribution(d) * 0.8;
  };

  var updateContribText = function updateContribText(d) {
    var totalContribution = computeContribution(d);
    var selfShare = totalContribution * 0.2,
        bossShare = totalContribution * 0.8;
    var data = d3.select(".bar[selected=true]").attr("data-val");
    var y = contribScale(computeContribution(data));
    var x = incomeScale(data);

    barValue.attr("transform", "translate(" + (x - (totalContribution < currentMonthly ? 30 : 0)) + ", " + y + ")");
    var textChild = barValue.select("text");
    var rectChild = barValue.select("rect");
    var bbox = textChild.node().getBBox();

    rectChild.attr("width", bbox.width + padding).attr("height", bbox.height + padding);

    textChild.text(d3.format("$.2s")(parseInt(totalContribution)));
  };

  var updateIncomeLabel = function updateIncomeLabel(d, y) {

    var x = incomeScale(d);

    var textChild = incomeValue.select("text");
    var rectChild = incomeValue.select("rect");
    var bbox = textChild.node().getBBox();

    incomeValue.attr("transform", "translate(" + (x - bbox.width / 4) + ", " + (y + 30) + ")");
    rectChild.attr("width", bbox.width + padding).attr("height", bbox.height + padding);

    textChild.text(d3.format("$,.4s")(d));
  };
  //1. Show a bar chart

  //2. Bar chart should have a guide at the top of it

  //3. Have a draggable slider


  var svg = d3.select("svg#chart"),
      margin = { top: 20, right: 40, bottom: 30, left: 20 },
      width = +svg.attr("width") - margin.left - margin.right,
      height = +svg.attr("height") - margin.top - margin.bottom,
      barWidth = 18,
      barGap = 2;

  // SCALES
  var incomeScale = d3.scaleLog().domain([Math.pow(10, 4), 6 * Math.pow(10, 5)]).range([0, width]);
  var contribScale = d3.scaleLinear().domain([0, 7000]).range([height, 0]);

  // AXIS
  var payPoints = [10000, 25000, 50000, 60000, 75000, 100000, 200000, 300000, 600000];
  var xAxis = d3.axisBottom(incomeScale).tickValues(payPoints).tickFormat(function (d) {
    return d3.format("$.1s")(d);
  });

  // BARS
  var barCount = width / (barWidth + barGap);
  var dataPoints = [];

  //Get data points
  while (dataPoints.length * (barWidth + barGap) < width) {
    var value = incomeScale.invert(dataPoints.length * (barWidth + barGap));
    dataPoints.push(parseInt(value));
  }

  var yAxis = d3.axisRight(contribScale).tickFormat(function (d) {
    return d3.format("$.2s")(d);
  });

  //

  svg.append("g").attr("class", "y--axis y--axis--monthly").attr("transform", "translate(" + (width + margin.left) + ", " + margin.top + ")").call(yAxis);

  svg.append("g").attr("class", "x--axis x--axis--income").attr("transform", "translate(" + margin.left / 2 + "," + (height + margin.top) + ")").call(xAxis);

  var bars = svg.append("g").attr("transform", "translate(" + margin.left / 2 + "," + margin.top + ")");;

  var barValue = svg.append("g").attr("class", "bar--value-container");
  barValue.append("rect").attr("class", "bar-container");
  barValue.append("text").attr("class", "bar--value");

  var incomeValue = svg.append("g").attr("class", "income--value-container");
  incomeValue.append("rect").attr("class", "income--container");
  incomeValue.append("text").attr("class", "income--value");

  // Build the bars
  var barsItem = bars.selectAll(".bar").data(dataPoints).enter().append("g").attr("class", "bar").attr("data-y", function (d) {
    return contribScale(computeContribution(d));
  }).attr("data-val", function (d) {
    return d;
  });

  barsItem.append("rect").attr("class", "contribution").attr("x", function (d, ind) {
    return ind * (barWidth + barGap);
  }).attr("y", function (d) {
    return contribScale(computeContribution(d));
  }).attr("width", barWidth).attr("height", function (d) {
    return height - contribScale(computeContribution(d) - computeEmployerContrib(d));
  });

  barsItem.append("rect").attr("class", "employer").attr("x", function (d, ind) {
    return ind * (barWidth + barGap);
  }).attr("y", function (d) {
    return contribScale(computeEmployerContrib(d));
  }).attr("width", barWidth).attr("height", function (d) {
    return height - contribScale(computeEmployerContrib(d));
  });
  //

  var container = svg.append("g").attr("class", "horizontal--slider").attr("transform", "translate(" + margin.left / 2 + ", " + (height + margin.top) + ")");

  container.call(calculatorSlider({
    scale: incomeScale,
    initialValue: INCOME,
    callback: function callback(value) {
      var selectedItem = Math.floor(incomeScale(value) / (barWidth + barGap));
      barsItem.attr("selected", function (d, ind) {
        return selectedItem === ind;
      });
      updateContribText(value);
      updateIncomeLabel(value, height);
    }
  }));

  updateContribText(INCOME);
  updateIncomeLabel(INCOME, height);

  svg.append("g").attr("transform", "translate(" + margin.left / 2 + "," + margin.top + ")").append("rect").attr("class", "current-expense").attr("x", 0).attr("width", width).attr("height", 1).attr("y", contribScale(currentMonthly));
});
"use strict";

var calculatorSlider = function calculatorSlider(_ref) {
    var scale = _ref.scale,
        callback = _ref.callback,
        initialValue = _ref.initialValue;
    return function (container) {

        var x = scale.clamp(true);

        x;

        var slider = container.append("g").attr("class", "slider");

        slider.append("line").attr("class", "track").attr("x1", x.range()[0]).attr("x2", x.range()[1]).select(function () {
            return this.parentNode.appendChild(this.cloneNode(true));
        }).attr("class", "track-inset").select(function () {
            return this.parentNode.appendChild(this.cloneNode(true));
        }).attr("class", "track-overlay").call(d3.drag().on("start.interrupt", function () {
            slider.interrupt();
        }).on("start drag", function () {
            scale(d3.event.x);
            handle.attr("cx", d3.event.x);
            callback(scale.invert(d3.event.x));
        }));

        // slider.insert("g", ".track-overlay")
        //     .attr("class", "ticks")
        //     .attr("transform", "translate(0," + 18 + ")")
        //   .selectAll("text")
        //   .data(x.ticks(10))
        //   .enter().append("text")
        //     .attr("x", x)
        //     .attr("text-anchor", "middle")
        //     .text(function(d) { return d; });

        var handle = slider.insert("circle", ".track-overlay").attr("class", "handle").attr("r", 9);

        // slider.transition() // Gratuitous intro!
        //     .duration(750)
        //     .tween("hue", function() {
        //       var i = d3.interpolate(0, 70);
        //       return function(t) {
        //         handle.attr("cx", x(t));
        //         callback(i(t));
        //       };
        //     });

        handle.attr("cx", x(initialValue || 60000));
        callback(initialValue || 60000);
    };
};
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFwcC5qcyIsImxpYi9zbGlkZXIuanMiXSwibmFtZXMiOlsiSU5DT01FIiwiREVEVUNUSUJMRSIsIlBSRU1JVU0iLCJFTVBMT1lFRCIsImN1cnJlbnRNb250aGx5IiwicGFkZGluZyIsIiQiLCJjb21wdXRlQ29udHJpYnV0aW9uIiwiZCIsImNvbXB1dGVFbXBsb3llckNvbnRyaWIiLCJ1cGRhdGVDb250cmliVGV4dCIsInRvdGFsQ29udHJpYnV0aW9uIiwic2VsZlNoYXJlIiwiYm9zc1NoYXJlIiwiZGF0YSIsImQzIiwic2VsZWN0IiwiYXR0ciIsInkiLCJjb250cmliU2NhbGUiLCJ4IiwiaW5jb21lU2NhbGUiLCJiYXJWYWx1ZSIsInRleHRDaGlsZCIsInJlY3RDaGlsZCIsImJib3giLCJub2RlIiwiZ2V0QkJveCIsIndpZHRoIiwiaGVpZ2h0IiwidGV4dCIsImZvcm1hdCIsInBhcnNlSW50IiwidXBkYXRlSW5jb21lTGFiZWwiLCJpbmNvbWVWYWx1ZSIsInN2ZyIsIm1hcmdpbiIsInRvcCIsInJpZ2h0IiwiYm90dG9tIiwibGVmdCIsImJhcldpZHRoIiwiYmFyR2FwIiwic2NhbGVMb2ciLCJkb21haW4iLCJNYXRoIiwicG93IiwicmFuZ2UiLCJzY2FsZUxpbmVhciIsInBheVBvaW50cyIsInhBeGlzIiwiYXhpc0JvdHRvbSIsInRpY2tWYWx1ZXMiLCJ0aWNrRm9ybWF0IiwiYmFyQ291bnQiLCJkYXRhUG9pbnRzIiwibGVuZ3RoIiwidmFsdWUiLCJpbnZlcnQiLCJwdXNoIiwieUF4aXMiLCJheGlzUmlnaHQiLCJhcHBlbmQiLCJjYWxsIiwiYmFycyIsImJhcnNJdGVtIiwic2VsZWN0QWxsIiwiZW50ZXIiLCJpbmQiLCJjb250YWluZXIiLCJjYWxjdWxhdG9yU2xpZGVyIiwic2NhbGUiLCJpbml0aWFsVmFsdWUiLCJjYWxsYmFjayIsInNlbGVjdGVkSXRlbSIsImZsb29yIiwiY2xhbXAiLCJzbGlkZXIiLCJwYXJlbnROb2RlIiwiYXBwZW5kQ2hpbGQiLCJjbG9uZU5vZGUiLCJkcmFnIiwib24iLCJpbnRlcnJ1cHQiLCJldmVudCIsImhhbmRsZSIsImluc2VydCJdLCJtYXBwaW5ncyI6Ijs7QUFBQSxJQUFNQSxTQUFTLEtBQWY7QUFBQSxJQUNNQyxhQUFhLElBRG5CO0FBQUEsSUFFTUMsVUFBVSxHQUZoQjtBQUFBLElBR01DLFdBQVcsSUFIakI7O0FBS0EsSUFBTUMsaUJBQWtCSCxhQUFXLEVBQVosR0FBa0JDLE9BQXpDO0FBQ0EsSUFBTUcsVUFBVSxDQUFoQjs7QUFFQUMsRUFBRSxZQUFJOztBQUdKLE1BQU1DLHNCQUFzQixTQUF0QkEsbUJBQXNCLENBQUNDLENBQUQsRUFBTztBQUNqQyxRQUFJQSxJQUFJLEtBQVIsRUFBZTtBQUNiLGFBQU8sQ0FBUDtBQUNELEtBRkQsTUFFTyxJQUFJQSxLQUFJLEtBQUosSUFBYUEsSUFBSSxLQUFyQixFQUEyQjtBQUNoQyxhQUFPLENBQUNBLElBQUksS0FBTCxJQUFjLElBQWQsR0FBcUIsRUFBNUI7QUFDRCxLQUZNLE1BRUEsSUFBSUEsS0FBSyxLQUFMLElBQWNBLElBQUksS0FBdEIsRUFBOEI7QUFDbkMsYUFBTyxDQUFDQSxJQUFFLEtBQUgsSUFBWSxJQUFaLEdBQW1CLEVBQTFCO0FBQ0QsS0FGTSxNQUVBLElBQUtBLEtBQUssS0FBTCxJQUFjQSxJQUFJLE1BQXZCLEVBQStCO0FBQ3BDLGFBQU8sQ0FBQ0EsSUFBSSxLQUFMLElBQWMsSUFBZCxHQUFxQixFQUE1QjtBQUNELEtBRk0sTUFFQSxJQUFLQSxLQUFLLE1BQUwsSUFBZUEsSUFBSSxNQUF4QixFQUFpQztBQUN0QyxhQUFPLENBQUNBLElBQUksS0FBTCxJQUFjLElBQWQsR0FBcUIsRUFBNUI7QUFDRCxLQUZNLE1BRUE7QUFDTCxhQUFPLENBQUNBLElBQUksS0FBTCxJQUFjLElBQWQsR0FBcUIsRUFBNUI7QUFDRDtBQUNGLEdBZEQ7O0FBZ0JBLE1BQU1DLHlCQUF5QixTQUF6QkEsc0JBQXlCLENBQUNELENBQUQsRUFBTztBQUNwQyxXQUFPRCxvQkFBb0JDLENBQXBCLElBQXlCLEdBQWhDO0FBQ0QsR0FGRDs7QUFJQSxNQUFNRSxvQkFBb0IsU0FBcEJBLGlCQUFvQixDQUFDRixDQUFELEVBQU87QUFDL0IsUUFBTUcsb0JBQW9CSixvQkFBb0JDLENBQXBCLENBQTFCO0FBQ0EsUUFBTUksWUFBWUQsb0JBQW9CLEdBQXRDO0FBQUEsUUFBNENFLFlBQVlGLG9CQUFvQixHQUE1RTtBQUNBLFFBQU1HLE9BQU9DLEdBQUdDLE1BQUgsQ0FBVSxxQkFBVixFQUFpQ0MsSUFBakMsQ0FBc0MsVUFBdEMsQ0FBYjtBQUNBLFFBQU1DLElBQUlDLGFBQWFaLG9CQUFvQk8sSUFBcEIsQ0FBYixDQUFWO0FBQ0EsUUFBTU0sSUFBSUMsWUFBWVAsSUFBWixDQUFWOztBQUlBUSxhQUFTTCxJQUFULENBQWMsV0FBZCxrQkFBdUNHLEtBQUtULG9CQUFvQlAsY0FBcEIsR0FBcUMsRUFBckMsR0FBMEMsQ0FBL0MsQ0FBdkMsV0FBNkZjLENBQTdGO0FBQ0EsUUFBSUssWUFBWUQsU0FBU04sTUFBVCxDQUFnQixNQUFoQixDQUFoQjtBQUNBLFFBQUlRLFlBQVlGLFNBQVNOLE1BQVQsQ0FBZ0IsTUFBaEIsQ0FBaEI7QUFDQSxRQUFJUyxPQUFPRixVQUFVRyxJQUFWLEdBQWlCQyxPQUFqQixFQUFYOztBQUdBSCxjQUFVUCxJQUFWLENBQWUsT0FBZixFQUF3QlEsS0FBS0csS0FBTCxHQUFhdkIsT0FBckMsRUFDR1ksSUFESCxDQUNRLFFBRFIsRUFDa0JRLEtBQUtJLE1BQUwsR0FBY3hCLE9BRGhDOztBQUdBa0IsY0FBVU8sSUFBVixDQUFlZixHQUFHZ0IsTUFBSCxDQUFVLE1BQVYsRUFBa0JDLFNBQVNyQixpQkFBVCxDQUFsQixDQUFmO0FBRUQsR0FwQkQ7O0FBc0JBLE1BQU1zQixvQkFBb0IsU0FBcEJBLGlCQUFvQixDQUFDekIsQ0FBRCxFQUFJVSxDQUFKLEVBQVU7O0FBRWxDLFFBQU1FLElBQUlDLFlBQVliLENBQVosQ0FBVjs7QUFHQSxRQUFJZSxZQUFZVyxZQUFZbEIsTUFBWixDQUFtQixNQUFuQixDQUFoQjtBQUNBLFFBQUlRLFlBQVlVLFlBQVlsQixNQUFaLENBQW1CLE1BQW5CLENBQWhCO0FBQ0EsUUFBSVMsT0FBT0YsVUFBVUcsSUFBVixHQUFpQkMsT0FBakIsRUFBWDs7QUFFQU8sZ0JBQVlqQixJQUFaLENBQWlCLFdBQWpCLGtCQUEwQ0csSUFBSUssS0FBS0csS0FBTCxHQUFXLENBQXpELFlBQStEVixJQUFJLEVBQW5FO0FBQ0FNLGNBQVVQLElBQVYsQ0FBZSxPQUFmLEVBQXdCUSxLQUFLRyxLQUFMLEdBQWF2QixPQUFyQyxFQUNHWSxJQURILENBQ1EsUUFEUixFQUNrQlEsS0FBS0ksTUFBTCxHQUFjeEIsT0FEaEM7O0FBR0FrQixjQUFVTyxJQUFWLENBQWVmLEdBQUdnQixNQUFILENBQVUsT0FBVixFQUFtQnZCLENBQW5CLENBQWY7QUFFRCxHQWZEO0FBZ0JBOztBQUVBOztBQUVBOzs7QUFHQSxNQUFJMkIsTUFBTXBCLEdBQUdDLE1BQUgsQ0FBVSxXQUFWLENBQVY7QUFBQSxNQUNJb0IsU0FBUyxFQUFDQyxLQUFLLEVBQU4sRUFBVUMsT0FBTyxFQUFqQixFQUFxQkMsUUFBUSxFQUE3QixFQUFpQ0MsTUFBTSxFQUF2QyxFQURiO0FBQUEsTUFFSVosUUFBUSxDQUFDTyxJQUFJbEIsSUFBSixDQUFTLE9BQVQsQ0FBRCxHQUFxQm1CLE9BQU9JLElBQTVCLEdBQW1DSixPQUFPRSxLQUZ0RDtBQUFBLE1BR0lULFNBQVMsQ0FBQ00sSUFBSWxCLElBQUosQ0FBUyxRQUFULENBQUQsR0FBc0JtQixPQUFPQyxHQUE3QixHQUFtQ0QsT0FBT0csTUFIdkQ7QUFBQSxNQUlJRSxXQUFXLEVBSmY7QUFBQSxNQUtJQyxTQUFTLENBTGI7O0FBUUE7QUFDQSxNQUFJckIsY0FBY04sR0FBRzRCLFFBQUgsR0FDQ0MsTUFERCxDQUNRLENBQUNDLEtBQUtDLEdBQUwsQ0FBUyxFQUFULEVBQVksQ0FBWixDQUFELEVBQWlCLElBQUlELEtBQUtDLEdBQUwsQ0FBUyxFQUFULEVBQVksQ0FBWixDQUFyQixDQURSLEVBRUNDLEtBRkQsQ0FFTyxDQUFDLENBQUQsRUFBSW5CLEtBQUosQ0FGUCxDQUFsQjtBQUdBLE1BQUlULGVBQWVKLEdBQUdpQyxXQUFILEdBQ0lKLE1BREosQ0FDVyxDQUFDLENBQUQsRUFBSSxJQUFKLENBRFgsRUFFSUcsS0FGSixDQUVVLENBQUNsQixNQUFELEVBQVMsQ0FBVCxDQUZWLENBQW5COztBQUlBO0FBQ0EsTUFBSW9CLFlBQVksQ0FBQyxLQUFELEVBQVEsS0FBUixFQUFlLEtBQWYsRUFBc0IsS0FBdEIsRUFBNkIsS0FBN0IsRUFBb0MsTUFBcEMsRUFBNEMsTUFBNUMsRUFBb0QsTUFBcEQsRUFBNEQsTUFBNUQsQ0FBaEI7QUFDQSxNQUFJQyxRQUFRbkMsR0FBR29DLFVBQUgsQ0FBYzlCLFdBQWQsRUFDRytCLFVBREgsQ0FDY0gsU0FEZCxFQUVHSSxVQUZILENBRWMsVUFBQzdDLENBQUQ7QUFBQSxXQUFLTyxHQUFHZ0IsTUFBSCxDQUFVLE1BQVYsRUFBa0J2QixDQUFsQixDQUFMO0FBQUEsR0FGZCxDQUFaOztBQUtBO0FBQ0EsTUFBSThDLFdBQVcxQixTQUFPYSxXQUFXQyxNQUFsQixDQUFmO0FBQ0EsTUFBSWEsYUFBYSxFQUFqQjs7QUFHQTtBQUNBLFNBQU9BLFdBQVdDLE1BQVgsSUFBcUJmLFdBQVdDLE1BQWhDLElBQTBDZCxLQUFqRCxFQUF3RDtBQUN0RCxRQUFJNkIsUUFBUXBDLFlBQVlxQyxNQUFaLENBQW1CSCxXQUFXQyxNQUFYLElBQXFCZixXQUFXQyxNQUFoQyxDQUFuQixDQUFaO0FBQ0FhLGVBQVdJLElBQVgsQ0FBZ0IzQixTQUFTeUIsS0FBVCxDQUFoQjtBQUNEOztBQUdELE1BQUlHLFFBQVE3QyxHQUFHOEMsU0FBSCxDQUFhMUMsWUFBYixFQUNHa0MsVUFESCxDQUNjLFVBQUM3QyxDQUFEO0FBQUEsV0FBS08sR0FBR2dCLE1BQUgsQ0FBVSxNQUFWLEVBQWtCdkIsQ0FBbEIsQ0FBTDtBQUFBLEdBRGQsQ0FBWjs7QUFHQTs7QUFFQTJCLE1BQUkyQixNQUFKLENBQVcsR0FBWCxFQUNLN0MsSUFETCxDQUNVLE9BRFYsRUFDa0IsMEJBRGxCLEVBRUtBLElBRkwsQ0FFVSxXQUZWLGtCQUVvQ1csUUFBUVEsT0FBT0ksSUFGbkQsV0FFNERKLE9BQU9DLEdBRm5FLFFBR0swQixJQUhMLENBR1VILEtBSFY7O0FBS0F6QixNQUFJMkIsTUFBSixDQUFXLEdBQVgsRUFDSzdDLElBREwsQ0FDVSxPQURWLEVBQ2tCLHlCQURsQixFQUVLQSxJQUZMLENBRVUsV0FGVixpQkFFb0NtQixPQUFPSSxJQUFQLEdBQVksQ0FGaEQsVUFFcURYLFNBQVNPLE9BQU9DLEdBRnJFLFNBR0swQixJQUhMLENBR1ViLEtBSFY7O0FBS0EsTUFBSWMsT0FBTzdCLElBQUkyQixNQUFKLENBQVcsR0FBWCxFQUNJN0MsSUFESixDQUNTLFdBRFQsRUFDc0IsZUFBZW1CLE9BQU9JLElBQVAsR0FBWSxDQUEzQixHQUErQixHQUEvQixHQUFxQ0osT0FBT0MsR0FBNUMsR0FBa0QsR0FEeEUsQ0FBWCxDQUN3Rjs7QUFFeEYsTUFBSWYsV0FBV2EsSUFBSTJCLE1BQUosQ0FBVyxHQUFYLEVBQWdCN0MsSUFBaEIsQ0FBcUIsT0FBckIsRUFBOEIsc0JBQTlCLENBQWY7QUFDSUssV0FBU3dDLE1BQVQsQ0FBZ0IsTUFBaEIsRUFBd0I3QyxJQUF4QixDQUE2QixPQUE3QixFQUFzQyxlQUF0QztBQUNBSyxXQUFTd0MsTUFBVCxDQUFnQixNQUFoQixFQUF3QjdDLElBQXhCLENBQTZCLE9BQTdCLEVBQXNDLFlBQXRDOztBQUVKLE1BQUlpQixjQUFjQyxJQUFJMkIsTUFBSixDQUFXLEdBQVgsRUFBZ0I3QyxJQUFoQixDQUFxQixPQUFyQixFQUE4Qix5QkFBOUIsQ0FBbEI7QUFDRWlCLGNBQVk0QixNQUFaLENBQW1CLE1BQW5CLEVBQTJCN0MsSUFBM0IsQ0FBZ0MsT0FBaEMsRUFBeUMsbUJBQXpDO0FBQ0FpQixjQUFZNEIsTUFBWixDQUFtQixNQUFuQixFQUEyQjdDLElBQTNCLENBQWdDLE9BQWhDLEVBQXlDLGVBQXpDOztBQUVGO0FBQ0EsTUFBSWdELFdBQVdELEtBQUtFLFNBQUwsQ0FBZSxNQUFmLEVBQ1ZwRCxJQURVLENBQ0x5QyxVQURLLEVBRVZZLEtBRlUsR0FHUkwsTUFIUSxDQUdELEdBSEMsRUFJTjdDLElBSk0sQ0FJRCxPQUpDLEVBSVEsS0FKUixFQUtOQSxJQUxNLENBS0QsUUFMQyxFQUtTLFVBQUNULENBQUQ7QUFBQSxXQUFNVyxhQUFhWixvQkFBb0JDLENBQXBCLENBQWIsQ0FBTjtBQUFBLEdBTFQsRUFNTlMsSUFOTSxDQU1ELFVBTkMsRUFNVyxVQUFDVCxDQUFEO0FBQUEsV0FBS0EsQ0FBTDtBQUFBLEdBTlgsQ0FBZjs7QUFRSXlELFdBQVNILE1BQVQsQ0FBZ0IsTUFBaEIsRUFDRzdDLElBREgsQ0FDUSxPQURSLEVBQ2lCLGNBRGpCLEVBRUdBLElBRkgsQ0FFUSxHQUZSLEVBRWEsVUFBQ1QsQ0FBRCxFQUFJNEQsR0FBSjtBQUFBLFdBQVlBLE9BQU8zQixXQUFXQyxNQUFsQixDQUFaO0FBQUEsR0FGYixFQUdHekIsSUFISCxDQUdRLEdBSFIsRUFHYSxVQUFDVCxDQUFELEVBQU87QUFDaEIsV0FBT1csYUFBYVosb0JBQW9CQyxDQUFwQixDQUFiLENBQVA7QUFDRCxHQUxILEVBTUdTLElBTkgsQ0FNUSxPQU5SLEVBTWlCd0IsUUFOakIsRUFPR3hCLElBUEgsQ0FPUSxRQVBSLEVBT2tCLFVBQUNULENBQUQ7QUFBQSxXQUFPcUIsU0FBU1YsYUFBYVosb0JBQW9CQyxDQUFwQixJQUF5QkMsdUJBQXVCRCxDQUF2QixDQUF0QyxDQUFoQjtBQUFBLEdBUGxCOztBQVNBeUQsV0FBU0gsTUFBVCxDQUFnQixNQUFoQixFQUNHN0MsSUFESCxDQUNRLE9BRFIsRUFDaUIsVUFEakIsRUFFR0EsSUFGSCxDQUVRLEdBRlIsRUFFYSxVQUFDVCxDQUFELEVBQUk0RCxHQUFKO0FBQUEsV0FBWUEsT0FBTzNCLFdBQVdDLE1BQWxCLENBQVo7QUFBQSxHQUZiLEVBR0d6QixJQUhILENBR1EsR0FIUixFQUdhLFVBQUNULENBQUQsRUFBTztBQUNoQixXQUFPVyxhQUFhVix1QkFBdUJELENBQXZCLENBQWIsQ0FBUDtBQUNELEdBTEgsRUFNR1MsSUFOSCxDQU1RLE9BTlIsRUFNaUJ3QixRQU5qQixFQU9HeEIsSUFQSCxDQU9RLFFBUFIsRUFPa0IsVUFBQ1QsQ0FBRDtBQUFBLFdBQU9xQixTQUFTVixhQUFhVix1QkFBdUJELENBQXZCLENBQWIsQ0FBaEI7QUFBQSxHQVBsQjtBQVFKOztBQUVBLE1BQUk2RCxZQUNGbEMsSUFDRzJCLE1BREgsQ0FDVSxHQURWLEVBRUc3QyxJQUZILENBRVEsT0FGUixFQUVpQixvQkFGakIsRUFHR0EsSUFISCxDQUdRLFdBSFIsaUJBR2tDbUIsT0FBT0ksSUFBUCxHQUFZLENBSDlDLFdBR29EWCxTQUFTTyxPQUFPQyxHQUhwRSxRQURGOztBQU1BZ0MsWUFBVU4sSUFBVixDQUFlTyxpQkFBaUI7QUFDOUJDLFdBQU9sRCxXQUR1QjtBQUU5Qm1ELGtCQUFjeEUsTUFGZ0I7QUFHOUJ5RSxjQUFVLGtCQUFDaEIsS0FBRCxFQUFXO0FBQ25CLFVBQUlpQixlQUFlN0IsS0FBSzhCLEtBQUwsQ0FBV3RELFlBQVlvQyxLQUFaLEtBQW9CaEIsV0FBU0MsTUFBN0IsQ0FBWCxDQUFuQjtBQUNBdUIsZUFBU2hELElBQVQsQ0FBYyxVQUFkLEVBQTBCLFVBQUNULENBQUQsRUFBSTRELEdBQUo7QUFBQSxlQUFZTSxpQkFBaUJOLEdBQTdCO0FBQUEsT0FBMUI7QUFDQTFELHdCQUFrQitDLEtBQWxCO0FBQ0F4Qix3QkFBa0J3QixLQUFsQixFQUF5QjVCLE1BQXpCO0FBQ0Q7QUFSNkIsR0FBakIsQ0FBZjs7QUFXQW5CLG9CQUFrQlYsTUFBbEI7QUFDQWlDLG9CQUFrQmpDLE1BQWxCLEVBQTBCNkIsTUFBMUI7O0FBRUFNLE1BQUkyQixNQUFKLENBQVcsR0FBWCxFQUNPN0MsSUFEUCxDQUNZLFdBRFosRUFDeUIsZUFBZW1CLE9BQU9JLElBQVAsR0FBWSxDQUEzQixHQUErQixHQUEvQixHQUFxQ0osT0FBT0MsR0FBNUMsR0FBa0QsR0FEM0UsRUFFT3lCLE1BRlAsQ0FFYyxNQUZkLEVBR083QyxJQUhQLENBR1ksT0FIWixFQUdxQixpQkFIckIsRUFJT0EsSUFKUCxDQUlZLEdBSlosRUFJaUIsQ0FKakIsRUFLT0EsSUFMUCxDQUtZLE9BTFosRUFLcUJXLEtBTHJCLEVBTU9YLElBTlAsQ0FNWSxRQU5aLEVBTXNCLENBTnRCLEVBT09BLElBUFAsQ0FPWSxHQVBaLEVBT2lCRSxhQUFhZixjQUFiLENBUGpCO0FBUUQsQ0F6TEQ7OztBQ1BBLElBQU1rRSxtQkFBbUIsU0FBbkJBLGdCQUFtQjtBQUFBLFFBQ3JCQyxLQURxQixRQUNyQkEsS0FEcUI7QUFBQSxRQUVyQkUsUUFGcUIsUUFFckJBLFFBRnFCO0FBQUEsUUFHckJELFlBSHFCLFFBR3JCQSxZQUhxQjtBQUFBLFdBSWpCLFVBQUNILFNBQUQsRUFBZTs7QUFFbkIsWUFBSWpELElBQUltRCxNQUFNSyxLQUFOLENBQVksSUFBWixDQUFSOztBQUVDeEQsU0FBRDs7QUFFQSxZQUFJeUQsU0FBU1IsVUFBVVAsTUFBVixDQUFpQixHQUFqQixFQUNSN0MsSUFEUSxDQUNILE9BREcsRUFDTSxRQUROLENBQWI7O0FBR0E0RCxlQUFPZixNQUFQLENBQWMsTUFBZCxFQUNLN0MsSUFETCxDQUNVLE9BRFYsRUFDbUIsT0FEbkIsRUFFS0EsSUFGTCxDQUVVLElBRlYsRUFFZ0JHLEVBQUUyQixLQUFGLEdBQVUsQ0FBVixDQUZoQixFQUdLOUIsSUFITCxDQUdVLElBSFYsRUFHZ0JHLEVBQUUyQixLQUFGLEdBQVUsQ0FBVixDQUhoQixFQUlHL0IsTUFKSCxDQUlVLFlBQVc7QUFBRSxtQkFBTyxLQUFLOEQsVUFBTCxDQUFnQkMsV0FBaEIsQ0FBNEIsS0FBS0MsU0FBTCxDQUFlLElBQWYsQ0FBNUIsQ0FBUDtBQUEyRCxTQUpsRixFQUtLL0QsSUFMTCxDQUtVLE9BTFYsRUFLbUIsYUFMbkIsRUFNR0QsTUFOSCxDQU1VLFlBQVc7QUFBRSxtQkFBTyxLQUFLOEQsVUFBTCxDQUFnQkMsV0FBaEIsQ0FBNEIsS0FBS0MsU0FBTCxDQUFlLElBQWYsQ0FBNUIsQ0FBUDtBQUEyRCxTQU5sRixFQU9LL0QsSUFQTCxDQU9VLE9BUFYsRUFPbUIsZUFQbkIsRUFRSzhDLElBUkwsQ0FRVWhELEdBQUdrRSxJQUFILEdBQ0RDLEVBREMsQ0FDRSxpQkFERixFQUNxQixZQUFXO0FBQUVMLG1CQUFPTSxTQUFQO0FBQXFCLFNBRHZELEVBRURELEVBRkMsQ0FFRSxZQUZGLEVBRWdCLFlBQVc7QUFDMUJYLGtCQUFNeEQsR0FBR3FFLEtBQUgsQ0FBU2hFLENBQWYsQ0FBRDtBQUNBaUUsbUJBQU9wRSxJQUFQLENBQVksSUFBWixFQUFrQkYsR0FBR3FFLEtBQUgsQ0FBU2hFLENBQTNCO0FBQ0FxRCxxQkFBU0YsTUFBTWIsTUFBTixDQUFhM0MsR0FBR3FFLEtBQUgsQ0FBU2hFLENBQXRCLENBQVQ7QUFDRCxTQU5DLENBUlY7O0FBZ0JBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQSxZQUFJaUUsU0FBU1IsT0FBT1MsTUFBUCxDQUFjLFFBQWQsRUFBd0IsZ0JBQXhCLEVBQ1JyRSxJQURRLENBQ0gsT0FERyxFQUNNLFFBRE4sRUFFUkEsSUFGUSxDQUVILEdBRkcsRUFFRSxDQUZGLENBQWI7O0FBSUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBb0UsZUFBT3BFLElBQVAsQ0FBWSxJQUFaLEVBQWtCRyxFQUFFb0QsZ0JBQWdCLEtBQWxCLENBQWxCO0FBQ0FDLGlCQUFTRCxnQkFBZ0IsS0FBekI7QUFFSCxLQXhEd0I7QUFBQSxDQUF6QiIsImZpbGUiOiJidW5kbGUuanMiLCJzb3VyY2VzQ29udGVudCI6WyJjb25zdCBJTkNPTUUgPSA2MDAwMCxcbiAgICAgIERFRFVDVElCTEUgPSA1MDAwLFxuICAgICAgUFJFTUlVTSA9IDYwMCxcbiAgICAgIEVNUExPWUVEID0gdHJ1ZTtcblxuY29uc3QgY3VycmVudE1vbnRobHkgPSAoREVEVUNUSUJMRS8xMikgKyBQUkVNSVVNO1xuY29uc3QgcGFkZGluZyA9IDU7XG5cbiQoKCk9PntcblxuXG4gIGNvbnN0IGNvbXB1dGVDb250cmlidXRpb24gPSAoZCkgPT4ge1xuICAgIGlmIChkIDwgMjUwMDApIHtcbiAgICAgIHJldHVybiAwO1xuICAgIH0gZWxzZSBpZiAoZCA+PTI1MDAwICYmIGQgPCA1MDAwMCl7XG4gICAgICByZXR1cm4gKGQgLSAyNTAwMCkgKiAwLjA5IC8gMTI7XG4gICAgfSBlbHNlIGlmIChkID49IDUwMDAwICYmIGQgPCA3NTAwMCApIHtcbiAgICAgIHJldHVybiAoZC0yNTAwMCkgKiAwLjExIC8gMTI7XG4gICAgfSBlbHNlIGlmICggZCA+PSA3NTAwMCAmJiBkIDwgMTAwMDAwKSB7XG4gICAgICByZXR1cm4gKGQgLSAyNTAwMCkgKiAwLjEyIC8gMTI7XG4gICAgfSBlbHNlIGlmICggZCA+PSAxMDAwMDAgJiYgZCA8IDIwMDAwMCApIHtcbiAgICAgIHJldHVybiAoZCAtIDI1MDAwKSAqIDAuMTQgLyAxMjtcbiAgICB9IGVsc2Uge1xuICAgICAgcmV0dXJuIChkIC0gMjUwMDApICogMC4xNiAvIDEyO1xuICAgIH1cbiAgfVxuXG4gIGNvbnN0IGNvbXB1dGVFbXBsb3llckNvbnRyaWIgPSAoZCkgPT4ge1xuICAgIHJldHVybiBjb21wdXRlQ29udHJpYnV0aW9uKGQpICogMC44O1xuICB9XG5cbiAgY29uc3QgdXBkYXRlQ29udHJpYlRleHQgPSAoZCkgPT4ge1xuICAgIGNvbnN0IHRvdGFsQ29udHJpYnV0aW9uID0gY29tcHV0ZUNvbnRyaWJ1dGlvbihkKTtcbiAgICBjb25zdCBzZWxmU2hhcmUgPSB0b3RhbENvbnRyaWJ1dGlvbiAqIDAuMiAsIGJvc3NTaGFyZSA9IHRvdGFsQ29udHJpYnV0aW9uICogMC44O1xuICAgIGNvbnN0IGRhdGEgPSBkMy5zZWxlY3QoXCIuYmFyW3NlbGVjdGVkPXRydWVdXCIpLmF0dHIoXCJkYXRhLXZhbFwiKTtcbiAgICBjb25zdCB5ID0gY29udHJpYlNjYWxlKGNvbXB1dGVDb250cmlidXRpb24oZGF0YSkpO1xuICAgIGNvbnN0IHggPSBpbmNvbWVTY2FsZShkYXRhKTtcblxuXG5cbiAgICBiYXJWYWx1ZS5hdHRyKFwidHJhbnNmb3JtXCIsYHRyYW5zbGF0ZSgke3ggLSAodG90YWxDb250cmlidXRpb24gPCBjdXJyZW50TW9udGhseSA/IDMwIDogMCl9LCAke3l9KWApO1xuICAgIHZhciB0ZXh0Q2hpbGQgPSBiYXJWYWx1ZS5zZWxlY3QoXCJ0ZXh0XCIpO1xuICAgIHZhciByZWN0Q2hpbGQgPSBiYXJWYWx1ZS5zZWxlY3QoXCJyZWN0XCIpXG4gICAgdmFyIGJib3ggPSB0ZXh0Q2hpbGQubm9kZSgpLmdldEJCb3goKTtcblxuXG4gICAgcmVjdENoaWxkLmF0dHIoXCJ3aWR0aFwiLCBiYm94LndpZHRoICsgcGFkZGluZylcbiAgICAgIC5hdHRyKFwiaGVpZ2h0XCIsIGJib3guaGVpZ2h0ICsgcGFkZGluZyk7XG5cbiAgICB0ZXh0Q2hpbGQudGV4dChkMy5mb3JtYXQoXCIkLjJzXCIpKHBhcnNlSW50KHRvdGFsQ29udHJpYnV0aW9uKSkpO1xuXG4gIH07XG5cbiAgY29uc3QgdXBkYXRlSW5jb21lTGFiZWwgPSAoZCwgeSkgPT4ge1xuXG4gICAgY29uc3QgeCA9IGluY29tZVNjYWxlKGQpO1xuXG5cbiAgICB2YXIgdGV4dENoaWxkID0gaW5jb21lVmFsdWUuc2VsZWN0KFwidGV4dFwiKTtcbiAgICB2YXIgcmVjdENoaWxkID0gaW5jb21lVmFsdWUuc2VsZWN0KFwicmVjdFwiKVxuICAgIHZhciBiYm94ID0gdGV4dENoaWxkLm5vZGUoKS5nZXRCQm94KCk7XG5cbiAgICBpbmNvbWVWYWx1ZS5hdHRyKFwidHJhbnNmb3JtXCIsYHRyYW5zbGF0ZSgke3ggLSBiYm94LndpZHRoLzR9LCAke3kgKyAzMH0pYCk7XG4gICAgcmVjdENoaWxkLmF0dHIoXCJ3aWR0aFwiLCBiYm94LndpZHRoICsgcGFkZGluZylcbiAgICAgIC5hdHRyKFwiaGVpZ2h0XCIsIGJib3guaGVpZ2h0ICsgcGFkZGluZyk7XG5cbiAgICB0ZXh0Q2hpbGQudGV4dChkMy5mb3JtYXQoXCIkLC40c1wiKShkKSk7XG5cbiAgfTtcbiAgLy8xLiBTaG93IGEgYmFyIGNoYXJ0XG5cbiAgLy8yLiBCYXIgY2hhcnQgc2hvdWxkIGhhdmUgYSBndWlkZSBhdCB0aGUgdG9wIG9mIGl0XG5cbiAgLy8zLiBIYXZlIGEgZHJhZ2dhYmxlIHNsaWRlclxuXG5cbiAgdmFyIHN2ZyA9IGQzLnNlbGVjdChcInN2ZyNjaGFydFwiKSxcbiAgICAgIG1hcmdpbiA9IHt0b3A6IDIwLCByaWdodDogNDAsIGJvdHRvbTogMzAsIGxlZnQ6IDIwfSxcbiAgICAgIHdpZHRoID0gK3N2Zy5hdHRyKFwid2lkdGhcIikgLSBtYXJnaW4ubGVmdCAtIG1hcmdpbi5yaWdodCxcbiAgICAgIGhlaWdodCA9ICtzdmcuYXR0cihcImhlaWdodFwiKSAtIG1hcmdpbi50b3AgLSBtYXJnaW4uYm90dG9tLFxuICAgICAgYmFyV2lkdGggPSAxOCxcbiAgICAgIGJhckdhcCA9IDI7XG5cblxuICAvLyBTQ0FMRVNcbiAgdmFyIGluY29tZVNjYWxlID0gZDMuc2NhbGVMb2coKVxuICAgICAgICAgICAgICAgICAgICAuZG9tYWluKFtNYXRoLnBvdygxMCw0KSwgNiAqIE1hdGgucG93KDEwLDUpXSlcbiAgICAgICAgICAgICAgICAgICAgLnJhbmdlKFswLCB3aWR0aF0pO1xuICB2YXIgY29udHJpYlNjYWxlID0gZDMuc2NhbGVMaW5lYXIoKVxuICAgICAgICAgICAgICAgICAgICAgICAgLmRvbWFpbihbMCwgNzAwMF0pXG4gICAgICAgICAgICAgICAgICAgICAgICAucmFuZ2UoW2hlaWdodCwgMF0pO1xuXG4gIC8vIEFYSVNcbiAgdmFyIHBheVBvaW50cyA9IFsxMDAwMCwgMjUwMDAsIDUwMDAwLCA2MDAwMCwgNzUwMDAsIDEwMDAwMCwgMjAwMDAwLCAzMDAwMDAsIDYwMDAwMF07XG4gIHZhciB4QXhpcyA9IGQzLmF4aXNCb3R0b20oaW5jb21lU2NhbGUpXG4gICAgICAgICAgICAgICAgLnRpY2tWYWx1ZXMocGF5UG9pbnRzKVxuICAgICAgICAgICAgICAgIC50aWNrRm9ybWF0KChkKT0+ZDMuZm9ybWF0KFwiJC4xc1wiKShkKSk7XG5cblxuICAvLyBCQVJTXG4gIHZhciBiYXJDb3VudCA9IHdpZHRoLyhiYXJXaWR0aCArIGJhckdhcCk7XG4gIHZhciBkYXRhUG9pbnRzID0gW107XG5cblxuICAvL0dldCBkYXRhIHBvaW50c1xuICB3aGlsZSAoZGF0YVBvaW50cy5sZW5ndGggKiAoYmFyV2lkdGggKyBiYXJHYXApIDwgd2lkdGgpIHtcbiAgICB2YXIgdmFsdWUgPSBpbmNvbWVTY2FsZS5pbnZlcnQoZGF0YVBvaW50cy5sZW5ndGggKiAoYmFyV2lkdGggKyBiYXJHYXApKTtcbiAgICBkYXRhUG9pbnRzLnB1c2gocGFyc2VJbnQodmFsdWUpKTtcbiAgfVxuXG5cbiAgdmFyIHlBeGlzID0gZDMuYXhpc1JpZ2h0KGNvbnRyaWJTY2FsZSlcbiAgICAgICAgICAgICAgICAudGlja0Zvcm1hdCgoZCk9PmQzLmZvcm1hdChcIiQuMnNcIikoZCkpO1xuXG4gIC8vXG5cbiAgc3ZnLmFwcGVuZChcImdcIilcbiAgICAgIC5hdHRyKFwiY2xhc3NcIixcInktLWF4aXMgeS0tYXhpcy0tbW9udGhseVwiKVxuICAgICAgLmF0dHIoXCJ0cmFuc2Zvcm1cIiwgYHRyYW5zbGF0ZSgke3dpZHRoICsgbWFyZ2luLmxlZnR9LCAke21hcmdpbi50b3B9KWApXG4gICAgICAuY2FsbCh5QXhpcyk7XG5cbiAgc3ZnLmFwcGVuZChcImdcIilcbiAgICAgIC5hdHRyKFwiY2xhc3NcIixcIngtLWF4aXMgeC0tYXhpcy0taW5jb21lXCIpXG4gICAgICAuYXR0cihcInRyYW5zZm9ybVwiLCBgdHJhbnNsYXRlKCR7bWFyZ2luLmxlZnQvMn0sJHtoZWlnaHQgKyBtYXJnaW4udG9wfSlgKVxuICAgICAgLmNhbGwoeEF4aXMpO1xuXG4gIHZhciBiYXJzID0gc3ZnLmFwcGVuZChcImdcIilcbiAgICAgICAgICAgICAgICAuYXR0cihcInRyYW5zZm9ybVwiLCBcInRyYW5zbGF0ZShcIiArIG1hcmdpbi5sZWZ0LzIgKyBcIixcIiArIG1hcmdpbi50b3AgKyBcIilcIik7O1xuXG4gIHZhciBiYXJWYWx1ZSA9IHN2Zy5hcHBlbmQoXCJnXCIpLmF0dHIoXCJjbGFzc1wiLCBcImJhci0tdmFsdWUtY29udGFpbmVyXCIpO1xuICAgICAgYmFyVmFsdWUuYXBwZW5kKFwicmVjdFwiKS5hdHRyKFwiY2xhc3NcIiwgXCJiYXItY29udGFpbmVyXCIpO1xuICAgICAgYmFyVmFsdWUuYXBwZW5kKFwidGV4dFwiKS5hdHRyKFwiY2xhc3NcIiwgXCJiYXItLXZhbHVlXCIpO1xuXG4gIHZhciBpbmNvbWVWYWx1ZSA9IHN2Zy5hcHBlbmQoXCJnXCIpLmF0dHIoXCJjbGFzc1wiLCBcImluY29tZS0tdmFsdWUtY29udGFpbmVyXCIpO1xuICAgIGluY29tZVZhbHVlLmFwcGVuZChcInJlY3RcIikuYXR0cihcImNsYXNzXCIsIFwiaW5jb21lLS1jb250YWluZXJcIik7XG4gICAgaW5jb21lVmFsdWUuYXBwZW5kKFwidGV4dFwiKS5hdHRyKFwiY2xhc3NcIiwgXCJpbmNvbWUtLXZhbHVlXCIpO1xuXG4gIC8vIEJ1aWxkIHRoZSBiYXJzXG4gIHZhciBiYXJzSXRlbSA9IGJhcnMuc2VsZWN0QWxsKFwiLmJhclwiKVxuICAgICAgLmRhdGEoZGF0YVBvaW50cylcbiAgICAgIC5lbnRlcigpXG4gICAgICAgIC5hcHBlbmQoXCJnXCIpXG4gICAgICAgICAgLmF0dHIoXCJjbGFzc1wiLCBcImJhclwiKVxuICAgICAgICAgIC5hdHRyKFwiZGF0YS15XCIsIChkKT0+IGNvbnRyaWJTY2FsZShjb21wdXRlQ29udHJpYnV0aW9uKGQpKSlcbiAgICAgICAgICAuYXR0cihcImRhdGEtdmFsXCIsIChkKT0+ZCk7XG5cbiAgICAgIGJhcnNJdGVtLmFwcGVuZChcInJlY3RcIilcbiAgICAgICAgLmF0dHIoXCJjbGFzc1wiLCBcImNvbnRyaWJ1dGlvblwiKVxuICAgICAgICAuYXR0cihcInhcIiwgKGQsIGluZCkgPT4gaW5kICogKGJhcldpZHRoICsgYmFyR2FwKSlcbiAgICAgICAgLmF0dHIoXCJ5XCIsIChkKSA9PiB7XG4gICAgICAgICAgcmV0dXJuIGNvbnRyaWJTY2FsZShjb21wdXRlQ29udHJpYnV0aW9uKGQpKTtcbiAgICAgICAgfSlcbiAgICAgICAgLmF0dHIoXCJ3aWR0aFwiLCBiYXJXaWR0aClcbiAgICAgICAgLmF0dHIoXCJoZWlnaHRcIiwgKGQpID0+IGhlaWdodCAtIGNvbnRyaWJTY2FsZShjb21wdXRlQ29udHJpYnV0aW9uKGQpIC0gY29tcHV0ZUVtcGxveWVyQ29udHJpYihkKSkpXG5cbiAgICAgIGJhcnNJdGVtLmFwcGVuZChcInJlY3RcIilcbiAgICAgICAgLmF0dHIoXCJjbGFzc1wiLCBcImVtcGxveWVyXCIpXG4gICAgICAgIC5hdHRyKFwieFwiLCAoZCwgaW5kKSA9PiBpbmQgKiAoYmFyV2lkdGggKyBiYXJHYXApKVxuICAgICAgICAuYXR0cihcInlcIiwgKGQpID0+IHtcbiAgICAgICAgICByZXR1cm4gY29udHJpYlNjYWxlKGNvbXB1dGVFbXBsb3llckNvbnRyaWIoZCkpO1xuICAgICAgICB9KVxuICAgICAgICAuYXR0cihcIndpZHRoXCIsIGJhcldpZHRoKVxuICAgICAgICAuYXR0cihcImhlaWdodFwiLCAoZCkgPT4gaGVpZ2h0IC0gY29udHJpYlNjYWxlKGNvbXB1dGVFbXBsb3llckNvbnRyaWIoZCkpKVxuICAvL1xuXG4gIHZhciBjb250YWluZXIgPVxuICAgIHN2Z1xuICAgICAgLmFwcGVuZChcImdcIilcbiAgICAgIC5hdHRyKFwiY2xhc3NcIiwgXCJob3Jpem9udGFsLS1zbGlkZXJcIilcbiAgICAgIC5hdHRyKFwidHJhbnNmb3JtXCIsIGB0cmFuc2xhdGUoJHttYXJnaW4ubGVmdC8yfSwgJHtoZWlnaHQgKyBtYXJnaW4udG9wfSlgKTtcblxuICBjb250YWluZXIuY2FsbChjYWxjdWxhdG9yU2xpZGVyKHtcbiAgICBzY2FsZTogaW5jb21lU2NhbGUsXG4gICAgaW5pdGlhbFZhbHVlOiBJTkNPTUUsXG4gICAgY2FsbGJhY2s6ICh2YWx1ZSkgPT4ge1xuICAgICAgdmFyIHNlbGVjdGVkSXRlbSA9IE1hdGguZmxvb3IoaW5jb21lU2NhbGUodmFsdWUpLyhiYXJXaWR0aCtiYXJHYXApKTtcbiAgICAgIGJhcnNJdGVtLmF0dHIoXCJzZWxlY3RlZFwiLCAoZCwgaW5kKSA9PiBzZWxlY3RlZEl0ZW0gPT09IGluZCk7XG4gICAgICB1cGRhdGVDb250cmliVGV4dCh2YWx1ZSk7XG4gICAgICB1cGRhdGVJbmNvbWVMYWJlbCh2YWx1ZSwgaGVpZ2h0KTtcbiAgICB9XG4gIH0pKTtcblxuICB1cGRhdGVDb250cmliVGV4dChJTkNPTUUpO1xuICB1cGRhdGVJbmNvbWVMYWJlbChJTkNPTUUsIGhlaWdodCk7XG5cbiAgc3ZnLmFwcGVuZChcImdcIilcbiAgICAgICAgLmF0dHIoXCJ0cmFuc2Zvcm1cIiwgXCJ0cmFuc2xhdGUoXCIgKyBtYXJnaW4ubGVmdC8yICsgXCIsXCIgKyBtYXJnaW4udG9wICsgXCIpXCIpXG4gICAgICAgIC5hcHBlbmQoXCJyZWN0XCIpXG4gICAgICAgIC5hdHRyKFwiY2xhc3NcIiwgXCJjdXJyZW50LWV4cGVuc2VcIilcbiAgICAgICAgLmF0dHIoXCJ4XCIsIDApXG4gICAgICAgIC5hdHRyKFwid2lkdGhcIiwgd2lkdGgpXG4gICAgICAgIC5hdHRyKFwiaGVpZ2h0XCIsIDEpXG4gICAgICAgIC5hdHRyKFwieVwiLCBjb250cmliU2NhbGUoY3VycmVudE1vbnRobHkpKVxufSk7XG4iLCJcbmNvbnN0IGNhbGN1bGF0b3JTbGlkZXIgPSAoe1xuICAgIHNjYWxlLFxuICAgIGNhbGxiYWNrLFxuICAgIGluaXRpYWxWYWx1ZSxcbiAgfSkgPT4gKGNvbnRhaW5lcikgPT4ge1xuXG4gICAgdmFyIHggPSBzY2FsZS5jbGFtcCh0cnVlKTtcblxuICAgICh4KTtcblxuICAgIHZhciBzbGlkZXIgPSBjb250YWluZXIuYXBwZW5kKFwiZ1wiKVxuICAgICAgICAuYXR0cihcImNsYXNzXCIsIFwic2xpZGVyXCIpICA7XG5cbiAgICBzbGlkZXIuYXBwZW5kKFwibGluZVwiKVxuICAgICAgICAuYXR0cihcImNsYXNzXCIsIFwidHJhY2tcIilcbiAgICAgICAgLmF0dHIoXCJ4MVwiLCB4LnJhbmdlKClbMF0pXG4gICAgICAgIC5hdHRyKFwieDJcIiwgeC5yYW5nZSgpWzFdKVxuICAgICAgLnNlbGVjdChmdW5jdGlvbigpIHsgcmV0dXJuIHRoaXMucGFyZW50Tm9kZS5hcHBlbmRDaGlsZCh0aGlzLmNsb25lTm9kZSh0cnVlKSk7IH0pXG4gICAgICAgIC5hdHRyKFwiY2xhc3NcIiwgXCJ0cmFjay1pbnNldFwiKVxuICAgICAgLnNlbGVjdChmdW5jdGlvbigpIHsgcmV0dXJuIHRoaXMucGFyZW50Tm9kZS5hcHBlbmRDaGlsZCh0aGlzLmNsb25lTm9kZSh0cnVlKSk7IH0pXG4gICAgICAgIC5hdHRyKFwiY2xhc3NcIiwgXCJ0cmFjay1vdmVybGF5XCIpXG4gICAgICAgIC5jYWxsKGQzLmRyYWcoKVxuICAgICAgICAgICAgLm9uKFwic3RhcnQuaW50ZXJydXB0XCIsIGZ1bmN0aW9uKCkgeyBzbGlkZXIuaW50ZXJydXB0KCk7IH0pXG4gICAgICAgICAgICAub24oXCJzdGFydCBkcmFnXCIsIGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAoc2NhbGUoZDMuZXZlbnQueCkpXG4gICAgICAgICAgICAgIGhhbmRsZS5hdHRyKFwiY3hcIiwgZDMuZXZlbnQueCk7XG4gICAgICAgICAgICAgIGNhbGxiYWNrKHNjYWxlLmludmVydChkMy5ldmVudC54KSk7XG4gICAgICAgICAgICB9KSk7XG5cbiAgICAvLyBzbGlkZXIuaW5zZXJ0KFwiZ1wiLCBcIi50cmFjay1vdmVybGF5XCIpXG4gICAgLy8gICAgIC5hdHRyKFwiY2xhc3NcIiwgXCJ0aWNrc1wiKVxuICAgIC8vICAgICAuYXR0cihcInRyYW5zZm9ybVwiLCBcInRyYW5zbGF0ZSgwLFwiICsgMTggKyBcIilcIilcbiAgICAvLyAgIC5zZWxlY3RBbGwoXCJ0ZXh0XCIpXG4gICAgLy8gICAuZGF0YSh4LnRpY2tzKDEwKSlcbiAgICAvLyAgIC5lbnRlcigpLmFwcGVuZChcInRleHRcIilcbiAgICAvLyAgICAgLmF0dHIoXCJ4XCIsIHgpXG4gICAgLy8gICAgIC5hdHRyKFwidGV4dC1hbmNob3JcIiwgXCJtaWRkbGVcIilcbiAgICAvLyAgICAgLnRleHQoZnVuY3Rpb24oZCkgeyByZXR1cm4gZDsgfSk7XG5cbiAgICB2YXIgaGFuZGxlID0gc2xpZGVyLmluc2VydChcImNpcmNsZVwiLCBcIi50cmFjay1vdmVybGF5XCIpXG4gICAgICAgIC5hdHRyKFwiY2xhc3NcIiwgXCJoYW5kbGVcIilcbiAgICAgICAgLmF0dHIoXCJyXCIsIDkpO1xuXG4gICAgLy8gc2xpZGVyLnRyYW5zaXRpb24oKSAvLyBHcmF0dWl0b3VzIGludHJvIVxuICAgIC8vICAgICAuZHVyYXRpb24oNzUwKVxuICAgIC8vICAgICAudHdlZW4oXCJodWVcIiwgZnVuY3Rpb24oKSB7XG4gICAgLy8gICAgICAgdmFyIGkgPSBkMy5pbnRlcnBvbGF0ZSgwLCA3MCk7XG4gICAgLy8gICAgICAgcmV0dXJuIGZ1bmN0aW9uKHQpIHtcbiAgICAvLyAgICAgICAgIGhhbmRsZS5hdHRyKFwiY3hcIiwgeCh0KSk7XG4gICAgLy8gICAgICAgICBjYWxsYmFjayhpKHQpKTtcbiAgICAvLyAgICAgICB9O1xuICAgIC8vICAgICB9KTtcblxuICAgIGhhbmRsZS5hdHRyKFwiY3hcIiwgeChpbml0aWFsVmFsdWUgfHwgNjAwMDApKVxuICAgIGNhbGxiYWNrKGluaXRpYWxWYWx1ZSB8fCA2MDAwMClcblxufTtcbiJdfQ==
