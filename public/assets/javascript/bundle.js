"use strict";

var INCOME = 60000,
    DEDUCTIBLE = 5000,
    PREMIUM = 600,
    EMPLOYED = true;
$(function () {

  var computeContribution = function computeContribution(d) {
    if (d < 25000) {
      return 0;
    } else if (d >= 25000 && d < 50000) {
      return (d - 25000) * 0.09 / 12;
    } else if (d >= 50000 && d < 75000) {
      return (d - 25000) * 0.11 / 12;
    } else if (d >= 75000 && d < 100000) {
      return (d - 25000) * 0.12 / 12;
    } else if (d >= 100000 && d < 200000) {
      return (d - 25000) * 0.14 / 12;
    } else {
      return (d - 25000) * 0.16 / 12;
    }
  };

  var computeEmployerContrib = function computeEmployerContrib(d) {
    return computeContribution(d) * 0.8;
  };
  //1. Show a bar chart

  //2. Bar chart should have a guide at the top of it

  //3. Have a draggable slider


  var svg = d3.select("svg#chart"),
      margin = { top: 20, right: 40, bottom: 30, left: 20 },
      width = +svg.attr("width") - margin.left - margin.right,
      height = +svg.attr("height") - margin.top - margin.bottom,
      barWidth = 18,
      barGap = 2;

  console.log(svg.attr("width"));
  // SCALES
  var incomeScale = d3.scaleLog().domain([Math.pow(10, 4), 6 * Math.pow(10, 5)]).range([0, width]);
  var contribScale = d3.scaleLinear().domain([0, 7000]).range([height, 0]);

  // AXIS
  var payPoints = [10000, 25000, 50000, 60000, 75000, 100000, 200000, 300000, 600000];
  var xAxis = d3.axisBottom(incomeScale).tickValues(payPoints).tickFormat(function (d) {
    return d3.format("$.1s")(d);
  });

  // BARS
  var barCount = width / (barWidth + barGap);
  var dataPoints = [];

  var currentMonthly = contribScale(DEDUCTIBLE / 12 + PREMIUM);

  //Get data points
  while (dataPoints.length * (barWidth + barGap) < width) {
    var value = incomeScale.invert(dataPoints.length * (barWidth + barGap));
    dataPoints.push(parseInt(value));
  }

  var yAxis = d3.axisRight(contribScale).tickFormat(function (d) {
    return d3.format("$.2s")(d);
  });

  // console.log("FINAL", dataPoints);

  svg.append("g").attr("class", "y--axis y--axis--monthly").attr("transform", "translate(" + (width + margin.left) + ", " + margin.top + ")").call(yAxis);

  svg.append("g").attr("class", "x--axis x--axis--income").attr("transform", "translate(" + margin.left / 2 + "," + (height + margin.top) + ")").call(xAxis);

  var bars = svg.append("g").attr("transform", "translate(" + margin.left / 2 + "," + margin.top + ")");;

  console.log(dataPoints.map(computeContribution));

  // Build the bars
  var barsItem = bars.selectAll(".bar").data(dataPoints).enter().append("g").attr("class", "bar").attr("data-y", function (d) {
    return contribScale(computeContribution(d));
  }).attr("data-val", function (d) {
    return d;
  });

  barsItem.append("rect").attr("class", "contribution").attr("x", function (d, ind) {
    return ind * (barWidth + barGap);
  }).attr("y", function (d) {
    return contribScale(computeContribution(d));
  }).attr("width", barWidth).attr("height", function (d) {
    return height - contribScale(computeContribution(d) - computeEmployerContrib(d));
  });

  barsItem.append("rect").attr("class", "employer").attr("x", function (d, ind) {
    return ind * (barWidth + barGap);
  }).attr("y", function (d) {
    return contribScale(computeEmployerContrib(d));
  }).attr("width", barWidth).attr("height", function (d) {
    return height - contribScale(computeEmployerContrib(d));
  });
  // console.log(incomeScale);

  var container = svg.append("g").attr("class", "horizontal--slider").attr("transform", "translate(" + margin.left / 2 + ", " + (height + margin.top) + ")");

  container.call(calculatorSlider({
    scale: incomeScale,
    callback: function callback(value) {
      console.log("test", Math.floor(incomeScale(value) / (barWidth + barGap)));
      var selectedItem = Math.floor(incomeScale(value) / (barWidth + barGap));
      barsItem.attr("selected", function (d, ind) {
        return selectedItem === ind;
      });
    }
  }));

  // Build the line
  console.log(DEDUCTIBLE / 12 + PREMIUM, contribScale(DEDUCTIBLE / 12 + PREMIUM));

  svg.append("g").attr("transform", "translate(" + margin.left / 2 + "," + margin.top + ")").append("rect").attr("class", "current-expense").attr("x", 0).attr("width", width).attr("height", 1).attr("y", currentMonthly);
});
"use strict";

var calculatorSlider = function calculatorSlider(_ref) {
    var scale = _ref.scale,
        callback = _ref.callback,
        initialValue = _ref.initialValue;
    return function (container) {

        var x = scale.clamp(true);

        console.log(x);

        var slider = container.append("g").attr("class", "slider");

        slider.append("line").attr("class", "track").attr("x1", x.range()[0]).attr("x2", x.range()[1]).select(function () {
            return this.parentNode.appendChild(this.cloneNode(true));
        }).attr("class", "track-inset").select(function () {
            return this.parentNode.appendChild(this.cloneNode(true));
        }).attr("class", "track-overlay").call(d3.drag().on("start.interrupt", function () {
            slider.interrupt();
        }).on("start drag", function () {
            console.log(scale(d3.event.x));
            handle.attr("cx", d3.event.x);
            callback(scale.invert(d3.event.x));
        }));

        // slider.insert("g", ".track-overlay")
        //     .attr("class", "ticks")
        //     .attr("transform", "translate(0," + 18 + ")")
        //   .selectAll("text")
        //   .data(x.ticks(10))
        //   .enter().append("text")
        //     .attr("x", x)
        //     .attr("text-anchor", "middle")
        //     .text(function(d) { return d; });

        var handle = slider.insert("circle", ".track-overlay").attr("class", "handle").attr("r", 9);

        // slider.transition() // Gratuitous intro!
        //     .duration(750)
        //     .tween("hue", function() {
        //       var i = d3.interpolate(0, 70);
        //       return function(t) {
        //         handle.attr("cx", x(t));
        //         callback(i(t));
        //       };
        //     });

        handle.attr("cx", x(initialValue || 60000));
        callback(initialValue || 60000);
    };
};
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFwcC5qcyIsImxpYi9zbGlkZXIuanMiXSwibmFtZXMiOlsiSU5DT01FIiwiREVEVUNUSUJMRSIsIlBSRU1JVU0iLCJFTVBMT1lFRCIsIiQiLCJjb21wdXRlQ29udHJpYnV0aW9uIiwiZCIsImNvbXB1dGVFbXBsb3llckNvbnRyaWIiLCJzdmciLCJkMyIsInNlbGVjdCIsIm1hcmdpbiIsInRvcCIsInJpZ2h0IiwiYm90dG9tIiwibGVmdCIsIndpZHRoIiwiYXR0ciIsImhlaWdodCIsImJhcldpZHRoIiwiYmFyR2FwIiwiY29uc29sZSIsImxvZyIsImluY29tZVNjYWxlIiwic2NhbGVMb2ciLCJkb21haW4iLCJNYXRoIiwicG93IiwicmFuZ2UiLCJjb250cmliU2NhbGUiLCJzY2FsZUxpbmVhciIsInBheVBvaW50cyIsInhBeGlzIiwiYXhpc0JvdHRvbSIsInRpY2tWYWx1ZXMiLCJ0aWNrRm9ybWF0IiwiZm9ybWF0IiwiYmFyQ291bnQiLCJkYXRhUG9pbnRzIiwiY3VycmVudE1vbnRobHkiLCJsZW5ndGgiLCJ2YWx1ZSIsImludmVydCIsInB1c2giLCJwYXJzZUludCIsInlBeGlzIiwiYXhpc1JpZ2h0IiwiYXBwZW5kIiwiY2FsbCIsImJhcnMiLCJtYXAiLCJiYXJzSXRlbSIsInNlbGVjdEFsbCIsImRhdGEiLCJlbnRlciIsImluZCIsImNvbnRhaW5lciIsImNhbGN1bGF0b3JTbGlkZXIiLCJzY2FsZSIsImNhbGxiYWNrIiwiZmxvb3IiLCJzZWxlY3RlZEl0ZW0iLCJpbml0aWFsVmFsdWUiLCJ4IiwiY2xhbXAiLCJzbGlkZXIiLCJwYXJlbnROb2RlIiwiYXBwZW5kQ2hpbGQiLCJjbG9uZU5vZGUiLCJkcmFnIiwib24iLCJpbnRlcnJ1cHQiLCJldmVudCIsImhhbmRsZSIsImluc2VydCJdLCJtYXBwaW5ncyI6Ijs7QUFBQSxJQUFNQSxTQUFTLEtBQWY7QUFBQSxJQUNNQyxhQUFhLElBRG5CO0FBQUEsSUFFTUMsVUFBVSxHQUZoQjtBQUFBLElBR01DLFdBQVcs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LE1BTkgsQ0FNVSxZQUFXO0FBQUUsbUJBQU8sS0FBS3dELFVBQUwsQ0FBZ0JDLFdBQWhCLENBQTRCLEtBQUtDLFNBQUwsQ0FBZSxJQUFmLENBQTVCLENBQVA7QUFBMkQsU0FObEYsRUFPS25ELElBUEwsQ0FPVSxPQVBWLEVBT21CLGVBUG5CLEVBUUsrQixJQVJMLENBUVV2QyxHQUFHNEQsSUFBSCxHQUNEQyxFQURDLENBQ0UsaUJBREYsRUFDcUIsWUFBVztBQUFFTCxtQkFBT00sU0FBUDtBQUFxQixTQUR2RCxFQUVERCxFQUZDLENBRUUsWUFGRixFQUVnQixZQUFXO0FBQzNCakQsb0JBQVFDLEdBQVIsQ0FBWW9DLE1BQU1qRCxHQUFHK0QsS0FBSCxDQUFTVCxDQUFmLENBQVo7QUFDQVUsbUJBQU94RCxJQUFQLENBQVksSUFBWixFQUFrQlIsR0FBRytELEtBQUgsQ0FBU1QsQ0FBM0I7QUFDQUoscUJBQVNELE1BQU1oQixNQUFOLENBQWFqQyxHQUFHK0QsS0FBSCxDQUFTVCxDQUF0QixDQUFUO0FBQ0QsU0FOQyxDQVJWOztBQWdCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUEsWUFBSVUsU0FBU1IsT0FBT1MsTUFBUCxDQUFjLFFBQWQsRUFBd0IsZ0JBQXhCLEVBQ1J6RCxJQURRLENBQ0gsT0FERyxFQUNNLFFBRE4sRUFFUkEsSUFGUSxDQUVILEdBRkcsRUFFRSxDQUZGLENBQWI7O0FBSUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBd0QsZUFBT3hELElBQVAsQ0FBWSxJQUFaLEVBQWtCOEMsRUFBRUQsZ0JBQWdCLEtBQWxCLENBQWxCO0FBQ0FILGlCQUFTRyxnQkFBZ0IsS0FBekI7QUFFSCxLQXhEd0I7QUFBQSxDQUF6QiIsImZpbGUiOiJidW5kbGUuanMiLCJzb3VyY2VzQ29udGVudCI6WyJjb25zdCBJTkNPTUUgPSA2MDAwMCxcbiAgICAgIERFRFVDVElCTEUgPSA1MDAwLFxuICAgICAgUFJFTUlVTSA9IDYwMCxcbiAgICAgIEVNUExPWUVEID0gdHJ1ZTtcbiQoKCk9PntcblxuXG4gIGNvbnN0IGNvbXB1dGVDb250cmlidXRpb24gPSAoZCkgPT4ge1xuICAgIGlmIChkIDwgMjUwMDApIHtcbiAgICAgIHJldHVybiAwO1xuICAgIH0gZWxzZSBpZiAoZCA+PTI1MDAwICYmIGQgPCA1MDAwMCl7XG4gICAgICByZXR1cm4gKGQgLSAyNTAwMCkgKiAwLjA5IC8gMTI7XG4gICAgfSBlbHNlIGlmIChkID49IDUwMDAwICYmIGQgPCA3NTAwMCApIHtcbiAgICAgIHJldHVybiAoZC0yNTAwMCkgKiAwLjExIC8gMTI7XG4gICAgfSBlbHNlIGlmICggZCA+PSA3NTAwMCAmJiBkIDwgMTAwMDAwKSB7XG4gICAgICByZXR1cm4gKGQgLSAyNTAwMCkgKiAwLjEyIC8gMTI7XG4gICAgfSBlbHNlIGlmICggZCA+PSAxMDAwMDAgJiYgZCA8IDIwMDAwMCApIHtcbiAgICAgIHJldHVybiAoZCAtIDI1MDAwKSAqIDAuMTQgLyAxMjtcbiAgICB9IGVsc2Uge1xuICAgICAgcmV0dXJuIChkIC0gMjUwMDApICogMC4xNiAvIDEyO1xuICAgIH1cbiAgfVxuXG4gIGNvbnN0IGNvbXB1dGVFbXBsb3llckNvbnRyaWIgPSAoZCkgPT4ge1xuICAgIHJldHVybiBjb21wdXRlQ29udHJpYnV0aW9uKGQpICogMC44O1xuICB9XG4gIC8vMS4gU2hvdyBhIGJhciBjaGFydFxuXG4gIC8vMi4gQmFyIGNoYXJ0IHNob3VsZCBoYXZlIGEgZ3VpZGUgYXQgdGhlIHRvcCBvZiBpdFxuXG4gIC8vMy4gSGF2ZSBhIGRyYWdnYWJsZSBzbGlkZXJcblxuXG4gIHZhciBzdmcgPSBkMy5zZWxlY3QoXCJzdmcjY2hhcnRcIiksXG4gICAgICBtYXJnaW4gPSB7dG9wOiAyMCwgcmlnaHQ6IDQwLCBib3R0b206IDMwLCBsZWZ0OiAyMH0sXG4gICAgICB3aWR0aCA9ICtzdmcuYXR0cihcIndpZHRoXCIpIC0gbWFyZ2luLmxlZnQgLSBtYXJnaW4ucmlnaHQsXG4gICAgICBoZWlnaHQgPSArc3ZnLmF0dHIoXCJoZWlnaHRcIikgLSBtYXJnaW4udG9wIC0gbWFyZ2luLmJvdHRvbSxcbiAgICAgIGJhcldpZHRoID0gMTgsXG4gICAgICBiYXJHYXAgPSAyO1xuXG4gIGNvbnNvbGUubG9nKHN2Zy5hdHRyKFwid2lkdGhcIikpO1xuICAvLyBTQ0FMRVNcbiAgdmFyIGluY29tZVNjYWxlID0gZDMuc2NhbGVMb2coKVxuICAgICAgICAgICAgICAgICAgICAuZG9tYWluKFtNYXRoLnBvdygxMCw0KSwgNiAqIE1hdGgucG93KDEwLDUpXSlcbiAgICAgICAgICAgICAgICAgICAgLnJhbmdlKFswLCB3aWR0aF0pO1xuICB2YXIgY29udHJpYlNjYWxlID0gZDMuc2NhbGVMaW5lYXIoKVxuICAgICAgICAgICAgICAgICAgICAgICAgLmRvbWFpbihbMCwgNzAwMF0pXG4gICAgICAgICAgICAgICAgICAgICAgICAucmFuZ2UoW2hlaWdodCwgMF0pO1xuXG4gIC8vIEFYSVNcbiAgdmFyIHBheVBvaW50cyA9IFsxMDAwMCwgMjUwMDAsIDUwMDAwLCA2MDAwMCwgNzUwMDAsIDEwMDAwMCwgMjAwMDAwLCAzMDAwMDAsIDYwMDAwMF07XG4gIHZhciB4QXhpcyA9IGQzLmF4aXNCb3R0b20oaW5jb21lU2NhbGUpXG4gICAgICAgICAgICAgICAgLnRpY2tWYWx1ZXMocGF5UG9pbnRzKVxuICAgICAgICAgICAgICAgIC50aWNrRm9ybWF0KChkKT0+ZDMuZm9ybWF0KFwiJC4xc1wiKShkKSk7XG5cblxuICAvLyBCQVJTXG4gIHZhciBiYXJDb3VudCA9IHdpZHRoLyhiYXJXaWR0aCArIGJhckdhcCk7XG4gIHZhciBkYXRhUG9pbnRzID0gW107XG5cbiAgY29uc3QgY3VycmVudE1vbnRobHkgPSBjb250cmliU2NhbGUoKERFRFVDVElCTEUvMTIpICsgUFJFTUlVTSk7XG5cbiAgLy9HZXQgZGF0YSBwb2ludHNcbiAgd2hpbGUgKGRhdGFQb2ludHMubGVuZ3RoICogKGJhcldpZHRoICsgYmFyR2FwKSA8IHdpZHRoKSB7XG4gICAgdmFyIHZhbHVlID0gaW5jb21lU2NhbGUuaW52ZXJ0KGRhdGFQb2ludHMubGVuZ3RoICogKGJhcldpZHRoICsgYmFyR2FwKSk7XG4gICAgZGF0YVBvaW50cy5wdXNoKHBhcnNlSW50KHZhbHVlKSk7XG4gIH1cblxuXG4gIHZhciB5QXhpcyA9IGQzLmF4aXNSaWdodChjb250cmliU2NhbGUpXG4gICAgICAgICAgICAgICAgLnRpY2tGb3JtYXQoKGQpPT5kMy5mb3JtYXQoXCIkLjJzXCIpKGQpKTtcblxuICAvLyBjb25zb2xlLmxvZyhcIkZJTkFMXCIsIGRhdGFQb2ludHMpO1xuXG4gIHN2Zy5hcHBlbmQoXCJnXCIpXG4gICAgICAuYXR0cihcImNsYXNzXCIsXCJ5LS1heGlzIHktLWF4aXMtLW1vbnRobHlcIilcbiAgICAgIC5hdHRyKFwidHJhbnNmb3JtXCIsIGB0cmFuc2xhdGUoJHt3aWR0aCArIG1hcmdpbi5sZWZ0fSwgJHttYXJnaW4udG9wfSlgKVxuICAgICAgLmNhbGwoeUF4aXMpO1xuXG4gIHN2Zy5hcHBlbmQoXCJnXCIpXG4gICAgICAuYXR0cihcImNsYXNzXCIsXCJ4LS1heGlzIHgtLWF4aXMtLWluY29tZVwiKVxuICAgICAgLmF0dHIoXCJ0cmFuc2Zvcm1cIiwgYHRyYW5zbGF0ZSgke21hcmdpbi5sZWZ0LzJ9LCR7aGVpZ2h0ICsgbWFyZ2luLnRvcH0pYClcbiAgICAgIC5jYWxsKHhBeGlzKTtcblxuICB2YXIgYmFycyA9IHN2Zy5hcHBlbmQoXCJnXCIpXG4gICAgICAgICAgICAgICAgLmF0dHIoXCJ0cmFuc2Zvcm1cIiwgXCJ0cmFuc2xhdGUoXCIgKyBtYXJnaW4ubGVmdC8yICsgXCIsXCIgKyBtYXJnaW4udG9wICsgXCIpXCIpOztcblxuICBjb25zb2xlLmxvZyhkYXRhUG9pbnRzLm1hcChjb21wdXRlQ29udHJpYnV0aW9uKSk7XG5cbiAgLy8gQnVpbGQgdGhlIGJhcnNcbiAgdmFyIGJhcnNJdGVtID0gYmFycy5zZWxlY3RBbGwoXCIuYmFyXCIpXG4gICAgICAuZGF0YShkYXRhUG9pbnRzKVxuICAgICAgLmVudGVyKClcbiAgICAgICAgLmFwcGVuZChcImdcIilcbiAgICAgICAgICAuYXR0cihcImNsYXNzXCIsIFwiYmFyXCIpXG4gICAgICAgICAgLmF0dHIoXCJkYXRhLXlcIiwgKGQpPT4gY29udHJpYlNjYWxlKGNvbXB1dGVDb250cmlidXRpb24oZCkpKVxuICAgICAgICAgIC5hdHRyKFwiZGF0YS12YWxcIiwgKGQpPT5kKTtcblxuICAgICAgYmFyc0l0ZW0uYXBwZW5kKFwicmVjdFwiKVxuICAgICAgICAuYXR0cihcImNsYXNzXCIsIFwiY29udHJpYnV0aW9uXCIpXG4gICAgICAgIC5hdHRyKFwieFwiLCAoZCwgaW5kKSA9PiBpbmQgKiAoYmFyV2lkdGggKyBiYXJHYXApKVxuICAgICAgICAuYXR0cihcInlcIiwgKGQpID0+IHtcbiAgICAgICAgICByZXR1cm4gY29udHJpYlNjYWxlKGNvbXB1dGVDb250cmlidXRpb24oZCkpO1xuICAgICAgICB9KVxuICAgICAgICAuYXR0cihcIndpZHRoXCIsIGJhcldpZHRoKVxuICAgICAgICAuYXR0cihcImhlaWdodFwiLCAoZCkgPT4gaGVpZ2h0IC0gY29udHJpYlNjYWxlKGNvbXB1dGVDb250cmlidXRpb24oZCkgLSBjb21wdXRlRW1wbG95ZXJDb250cmliKGQpKSlcblxuICAgICAgYmFyc0l0ZW0uYXBwZW5kKFwicmVjdFwiKVxuICAgICAgICAuYXR0cihcImNsYXNzXCIsIFwiZW1wbG95ZXJcIilcbiAgICAgICAgLmF0dHIoXCJ4XCIsIChkLCBpbmQpID0+IGluZCAqIChiYXJXaWR0aCArIGJhckdhcCkpXG4gICAgICAgIC5hdHRyKFwieVwiLCAoZCkgPT4ge1xuICAgICAgICAgIHJldHVybiBjb250cmliU2NhbGUoY29tcHV0ZUVtcGxveWVyQ29udHJpYihkKSk7XG4gICAgICAgIH0pXG4gICAgICAgIC5hdHRyKFwid2lkdGhcIiwgYmFyV2lkdGgpXG4gICAgICAgIC5hdHRyKFwiaGVpZ2h0XCIsIChkKSA9PiBoZWlnaHQgLSBjb250cmliU2NhbGUoY29tcHV0ZUVtcGxveWVyQ29udHJpYihkKSkpXG4gIC8vIGNvbnNvbGUubG9nKGluY29tZVNjYWxlKTtcblxuICB2YXIgY29udGFpbmVyID1cbiAgICBzdmdcbiAgICAgIC5hcHBlbmQoXCJnXCIpXG4gICAgICAuYXR0cihcImNsYXNzXCIsIFwiaG9yaXpvbnRhbC0tc2xpZGVyXCIpXG4gICAgICAuYXR0cihcInRyYW5zZm9ybVwiLCBgdHJhbnNsYXRlKCR7bWFyZ2luLmxlZnQvMn0sICR7aGVpZ2h0ICsgbWFyZ2luLnRvcH0pYCk7XG5cbiAgY29udGFpbmVyLmNhbGwoY2FsY3VsYXRvclNsaWRlcih7XG4gICAgc2NhbGU6IGluY29tZVNjYWxlLFxuICAgIGNhbGxiYWNrOiAodmFsdWUpID0+IHtcbiAgICAgIGNvbnNvbGUubG9nKFwidGVzdFwiLCBNYXRoLmZsb29yKGluY29tZVNjYWxlKHZhbHVlKS8oYmFyV2lkdGgrYmFyR2FwKSkgKSA7XG4gICAgICB2YXIgc2VsZWN0ZWRJdGVtID0gTWF0aC5mbG9vcihpbmNvbWVTY2FsZSh2YWx1ZSkvKGJhcldpZHRoK2JhckdhcCkpO1xuICAgICAgYmFyc0l0ZW0uYXR0cihcInNlbGVjdGVkXCIsIChkLCBpbmQpID0+IHNlbGVjdGVkSXRlbSA9PT0gaW5kKTtcbiAgICB9XG4gIH0pKVxuXG4gIC8vIEJ1aWxkIHRoZSBsaW5lXG4gIGNvbnNvbGUubG9nKChERURVQ1RJQkxFLzEyKSArIFBSRU1JVU0sIGNvbnRyaWJTY2FsZSgoREVEVUNUSUJMRS8xMikgKyBQUkVNSVVNKSk7XG5cbiAgc3ZnLmFwcGVuZChcImdcIilcbiAgICAgICAgLmF0dHIoXCJ0cmFuc2Zvcm1cIiwgXCJ0cmFuc2xhdGUoXCIgKyBtYXJnaW4ubGVmdC8yICsgXCIsXCIgKyBtYXJnaW4udG9wICsgXCIpXCIpXG4gICAgICAgIC5hcHBlbmQoXCJyZWN0XCIpXG4gICAgICAgIC5hdHRyKFwiY2xhc3NcIiwgXCJjdXJyZW50LWV4cGVuc2VcIilcbiAgICAgICAgLmF0dHIoXCJ4XCIsIDApXG4gICAgICAgIC5hdHRyKFwid2lkdGhcIiwgd2lkdGgpXG4gICAgICAgIC5hdHRyKFwiaGVpZ2h0XCIsIDEpXG4gICAgICAgIC5hdHRyKFwieVwiLCBjdXJyZW50TW9udGhseSlcbn0pO1xuIiwiXG5jb25zdCBjYWxjdWxhdG9yU2xpZGVyID0gKHtcbiAgICBzY2FsZSxcbiAgICBjYWxsYmFjayxcbiAgICBpbml0aWFsVmFsdWUsXG4gIH0pID0+IChjb250YWluZXIpID0+IHtcblxuICAgIHZhciB4ID0gc2NhbGUuY2xhbXAodHJ1ZSk7XG5cbiAgICBjb25zb2xlLmxvZyh4KTtcblxuICAgIHZhciBzbGlkZXIgPSBjb250YWluZXIuYXBwZW5kKFwiZ1wiKVxuICAgICAgICAuYXR0cihcImNsYXNzXCIsIFwic2xpZGVyXCIpICA7XG5cbiAgICBzbGlkZXIuYXBwZW5kKFwibGluZVwiKVxuICAgICAgICAuYXR0cihcImNsYXNzXCIsIFwidHJhY2tcIilcbiAgICAgICAgLmF0dHIoXCJ4MVwiLCB4LnJhbmdlKClbMF0pXG4gICAgICAgIC5hdHRyKFwieDJcIiwgeC5yYW5nZSgpWzFdKVxuICAgICAgLnNlbGVjdChmdW5jdGlvbigpIHsgcmV0dXJuIHRoaXMucGFyZW50Tm9kZS5hcHBlbmRDaGlsZCh0aGlzLmNsb25lTm9kZSh0cnVlKSk7IH0pXG4gICAgICAgIC5hdHRyKFwiY2xhc3NcIiwgXCJ0cmFjay1pbnNldFwiKVxuICAgICAgLnNlbGVjdChmdW5jdGlvbigpIHsgcmV0dXJuIHRoaXMucGFyZW50Tm9kZS5hcHBlbmRDaGlsZCh0aGlzLmNsb25lTm9kZSh0cnVlKSk7IH0pXG4gICAgICAgIC5hdHRyKFwiY2xhc3NcIiwgXCJ0cmFjay1vdmVybGF5XCIpXG4gICAgICAgIC5jYWxsKGQzLmRyYWcoKVxuICAgICAgICAgICAgLm9uKFwic3RhcnQuaW50ZXJydXB0XCIsIGZ1bmN0aW9uKCkgeyBzbGlkZXIuaW50ZXJydXB0KCk7IH0pXG4gICAgICAgICAgICAub24oXCJzdGFydCBkcmFnXCIsIGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICBjb25zb2xlLmxvZyhzY2FsZShkMy5ldmVudC54KSlcbiAgICAgICAgICAgICAgaGFuZGxlLmF0dHIoXCJjeFwiLCBkMy5ldmVudC54KTtcbiAgICAgICAgICAgICAgY2FsbGJhY2soc2NhbGUuaW52ZXJ0KGQzLmV2ZW50LngpKTtcbiAgICAgICAgICAgIH0pKTtcblxuICAgIC8vIHNsaWRlci5pbnNlcnQoXCJnXCIsIFwiLnRyYWNrLW92ZXJsYXlcIilcbiAgICAvLyAgICAgLmF0dHIoXCJjbGFzc1wiLCBcInRpY2tzXCIpXG4gICAgLy8gICAgIC5hdHRyKFwidHJhbnNmb3JtXCIsIFwidHJhbnNsYXRlKDAsXCIgKyAxOCArIFwiKVwiKVxuICAgIC8vICAgLnNlbGVjdEFsbChcInRleHRcIilcbiAgICAvLyAgIC5kYXRhKHgudGlja3MoMTApKVxuICAgIC8vICAgLmVudGVyKCkuYXBwZW5kKFwidGV4dFwiKVxuICAgIC8vICAgICAuYXR0cihcInhcIiwgeClcbiAgICAvLyAgICAgLmF0dHIoXCJ0ZXh0LWFuY2hvclwiLCBcIm1pZGRsZVwiKVxuICAgIC8vICAgICAudGV4dChmdW5jdGlvbihkKSB7IHJldHVybiBkOyB9KTtcblxuICAgIHZhciBoYW5kbGUgPSBzbGlkZXIuaW5zZXJ0KFwiY2lyY2xlXCIsIFwiLnRyYWNrLW92ZXJsYXlcIilcbiAgICAgICAgLmF0dHIoXCJjbGFzc1wiLCBcImhhbmRsZVwiKVxuICAgICAgICAuYXR0cihcInJcIiwgOSk7XG5cbiAgICAvLyBzbGlkZXIudHJhbnNpdGlvbigpIC8vIEdyYXR1aXRvdXMgaW50cm8hXG4gICAgLy8gICAgIC5kdXJhdGlvbig3NTApXG4gICAgLy8gICAgIC50d2VlbihcImh1ZVwiLCBmdW5jdGlvbigpIHtcbiAgICAvLyAgICAgICB2YXIgaSA9IGQzLmludGVycG9sYXRlKDAsIDcwKTtcbiAgICAvLyAgICAgICByZXR1cm4gZnVuY3Rpb24odCkge1xuICAgIC8vICAgICAgICAgaGFuZGxlLmF0dHIoXCJjeFwiLCB4KHQpKTtcbiAgICAvLyAgICAgICAgIGNhbGxiYWNrKGkodCkpO1xuICAgIC8vICAgICAgIH07XG4gICAgLy8gICAgIH0pO1xuXG4gICAgaGFuZGxlLmF0dHIoXCJjeFwiLCB4KGluaXRpYWxWYWx1ZSB8fCA2MDAwMCkpXG4gICAgY2FsbGJhY2soaW5pdGlhbFZhbHVlIHx8IDYwMDAwKVxuXG59O1xuIl19
