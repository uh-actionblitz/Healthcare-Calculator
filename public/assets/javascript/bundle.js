"use strict";

var INCOME = 60000,
    DEDUCTIBLE = 5000,
    PREMIUM = 600,
    EMPLOYED = true;

var currentMonthly = DEDUCTIBLE / 12 + PREMIUM;

$(function () {

  var computeContribution = function computeContribution(d) {
    if (d < 25000) {
      return 0;
    } else if (d >= 25000 && d < 50000) {
      return (d - 25000) * 0.09 / 12;
    } else if (d >= 50000 && d < 75000) {
      return (d - 25000) * 0.11 / 12;
    } else if (d >= 75000 && d < 100000) {
      return (d - 25000) * 0.12 / 12;
    } else if (d >= 100000 && d < 200000) {
      return (d - 25000) * 0.14 / 12;
    } else {
      return (d - 25000) * 0.16 / 12;
    }
  };

  var computeEmployerContrib = function computeEmployerContrib(d) {
    return computeContribution(d) * 0.8;
  };

  var updateContribText = function updateContribText(d) {
    var totalContribution = computeContribution(d);
    var selfShare = totalContribution * 0.2,
        bossShare = totalContribution * 0.8;
    var data = d3.select(".bar[selected=true]").attr("data-val");
    var padding = 5;
    var y = contribScale(computeContribution(data));
    var x = incomeScale(data);

    barValue.attr("transform", "translate(" + (x) + ", " + y + ")");
    var textChild = barValue.select("text");
    var rectChild = barValue.select("rect");
    var bbox = textChild.node().getBBox();

    rectChild.attr("width", bbox.width + padding).attr("height", bbox.height + padding);

    textChild.text(d3.format("$.2s")(parseInt(totalContribution)));
  };
  //1. Show a bar chart

  //2. Bar chart should have a guide at the top of it

  //3. Have a draggable slider


  var svg = d3.select("svg#chart"),
      margin = { top: 20, right: 40, bottom: 30, left: 20 },
      width = +svg.attr("width") - margin.left - margin.right,
      height = +svg.attr("height") - margin.top - margin.bottom,
      barWidth = 18,
      barGap = 2;

  // SCALES
  var incomeScale = d3.scaleLog().domain([Math.pow(10, 4), 6 * Math.pow(10, 5)]).range([0, width]);
  var contribScale = d3.scaleLinear().domain([0, 7000]).range([height, 0]);

  // AXIS
  var payPoints = [10000, 25000, 50000, 60000, 75000, 100000, 200000, 300000, 600000];
  var xAxis = d3.axisBottom(incomeScale).tickValues(payPoints).tickFormat(function (d) {
    return d3.format("$.1s")(d);
  });

  // BARS
  var barCount = width / (barWidth + barGap);
  var dataPoints = [];

  //Get data points
  while (dataPoints.length * (barWidth + barGap) < width) {
    var value = incomeScale.invert(dataPoints.length * (barWidth + barGap));
    dataPoints.push(parseInt(value));
  }

  var yAxis = d3.axisRight(contribScale).tickFormat(function (d) {
    return d3.format("$.2s")(d);
  });

  //

  svg.append("g").attr("class", "y--axis y--axis--monthly").attr("transform", "translate(" + (width + margin.left) + ", " + margin.top + ")").call(yAxis);

  svg.append("g").attr("class", "x--axis x--axis--income").attr("transform", "translate(" + margin.left / 2 + "," + (height + margin.top) + ")").call(xAxis);

  var bars = svg.append("g").attr("transform", "translate(" + margin.left / 2 + "," + margin.top + ")");;

  var barValue = svg.append("g").attr("class", "bar--value-container");
  barValue.append("rect").attr("class", "bar-container");
  barValue.append("text").attr("class", "bar--value");
  //

  // Build the bars
  var barsItem = bars.selectAll(".bar").data(dataPoints).enter().append("g").attr("class", "bar").attr("data-y", function (d) {
    return contribScale(computeContribution(d));
  }).attr("data-val", function (d) {
    return d;
  });

  barsItem.append("rect").attr("class", "contribution").attr("x", function (d, ind) {
    return ind * (barWidth + barGap);
  }).attr("y", function (d) {
    return contribScale(computeContribution(d));
  }).attr("width", barWidth).attr("height", function (d) {
    return height - contribScale(computeContribution(d) - computeEmployerContrib(d));
  });

  barsItem.append("rect").attr("class", "employer").attr("x", function (d, ind) {
    return ind * (barWidth + barGap);
  }).attr("y", function (d) {
    return contribScale(computeEmployerContrib(d));
  }).attr("width", barWidth).attr("height", function (d) {
    return height - contribScale(computeEmployerContrib(d));
  });
  //

  var container = svg.append("g").attr("class", "horizontal--slider").attr("transform", "translate(" + margin.left / 2 + ", " + (height + margin.top) + ")");

  container.call(calculatorSlider({
    scale: incomeScale,
    initialValue: INCOME,
    callback: function callback(value) {
      var selectedItem = Math.floor(incomeScale(value) / (barWidth + barGap));
      barsItem.attr("selected", function (d, ind) {
        return selectedItem === ind;
      });
      updateContribText(value);
    }
  }));
  updateContribText(INCOME);

  svg.append("g").attr("transform", "translate(" + margin.left / 2 + "," + margin.top + ")").append("rect").attr("class", "current-expense").attr("x", 0).attr("width", width).attr("height", 1).attr("y", contribScale(currentMonthly));
});
"use strict";

var calculatorSlider = function calculatorSlider(_ref) {
    var scale = _ref.scale,
        callback = _ref.callback,
        initialValue = _ref.initialValue;
    return function (container) {

        var x = scale.clamp(true);

        x;

        var slider = container.append("g").attr("class", "slider");

        slider.append("line").attr("class", "track").attr("x1", x.range()[0]).attr("x2", x.range()[1]).select(function () {
            return this.parentNode.appendChild(this.cloneNode(true));
        }).attr("class", "track-inset").select(function () {
            return this.parentNode.appendChild(this.cloneNode(true));
        }).attr("class", "track-overlay").call(d3.drag().on("start.interrupt", function () {
            slider.interrupt();
        }).on("start drag", function () {
            scale(d3.event.x);
            handle.attr("cx", d3.event.x);
            callback(scale.invert(d3.event.x));
        }));

        // slider.insert("g", ".track-overlay")
        //     .attr("class", "ticks")
        //     .attr("transform", "translate(0," + 18 + ")")
        //   .selectAll("text")
        //   .data(x.ticks(10))
        //   .enter().append("text")
        //     .attr("x", x)
        //     .attr("text-anchor", "middle")
        //     .text(function(d) { return d; });

        var handle = slider.insert("circle", ".track-overlay").attr("class", "handle").attr("r", 9);

        // slider.transition() // Gratuitous intro!
        //     .duration(750)
        //     .tween("hue", function() {
        //       var i = d3.interpolate(0, 70);
        //       return function(t) {
        //         handle.attr("cx", x(t));
        //         callback(i(t));
        //       };
        //     });

        handle.attr("cx", x(initialValue || 60000));
        callback(initialValue || 60000);
    };
};
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFwcC5qcyIsImxpYi9zbGlkZXIuanMiXSwibmFtZXMiOlsiSU5DT01FIiwiREVEVUNUSUJMRSIsIlBSRU1JVU0iLCJFTVBMT1lFRCIsImN1cnJlbnRNb250aGx5IiwiJCIsImNvbXB1dGVDb250cmlidXRpb24iLCJkIiwiY29tcHV0ZUVtcGxveWVyQ29udHJpYiIsInVwZGF0ZUNvbnRyaWJUZXh0IiwidG90YWxDb250cmlidXRpb24iLCJzZWxmU2hhcmUiLCJib3NzU2hhcmUiLCJkYXRhIiwiZDMiLCJzZWxlY3QiLCJhdHRyIiwicGFkZGluZyIsInkiLCJjb250cmliU2NhbGUiLCJ4IiwiaW5jb21lU2NhbGUiLCJiYXJWYWx1ZSIsInRleHRDaGlsZCIsInJlY3RDaGlsZCIsImJib3giLCJub2RlIiwiZ2V0QkJveCIsIndpZHRoIiwiaGVpZ2h0IiwidGV4dCIsImZvcm1hdCIsInBhcnNlSW50Iiwic3ZnIiwibWFyZ2luIiwidG9wIiwicmlnaHQiLCJib3R0b20iLCJsZWZ0IiwiYmFyV2lkdGgiLCJiYXJHYXAiLCJzY2FsZUxvZyIsImRvbWFpbiIsIk1hdGgiLCJwb3ciLCJyYW5nZSIsInNjYWxlTGluZWFyIiwicGF5UG9pbnRzIiwieEF4aXMiLCJheGlzQm90dG9tIiwidGlja1ZhbHVlcyIsInRpY2tGb3JtYXQiLCJiYXJDb3VudCIsImRhdGFQb2ludHMiLCJsZW5ndGgiLCJ2YWx1ZSIsImludmVydCIsInB1c2giLCJ5QXhpcyIsImF4aXNSaWdodCIsImFwcGVuZCIsImNhbGwiLCJiYXJzIiwiYmFyc0l0ZW0iLCJzZWxlY3RBbGwiLCJlbnRlciIsImluZCIsImNvbnRhaW5lciIsImNhbGN1bGF0b3JTbGlkZXIiLCJzY2FsZSIsImluaXRpYWxWYWx1ZSIsImNhbGxiYWNrIiwic2VsZWN0ZWRJdGVtIiwiZmxvb3IiLCJjbGFtcCIsInNsaWRlciIsInBhcmVudE5vZGUiLCJhcHBlbmRDaGlsZCIsImNsb25lTm9kZSIsImRyYWciLCJvbiIsImludGVycnVwdCIs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LFVBQUwsQ0FBZ0JDLFdBQWhCLENBQTRCLEtBQUtDLFNBQUwsQ0FBZSxJQUFmLENBQTVCLENBQVA7QUFBMkQsU0FObEYsRUFPSzlELElBUEwsQ0FPVSxPQVBWLEVBT21CLGVBUG5CLEVBUUs2QyxJQVJMLENBUVUvQyxHQUFHaUUsSUFBSCxHQUNEQyxFQURDLENBQ0UsaUJBREYsRUFDcUIsWUFBVztBQUFFTCxtQkFBT00sU0FBUDtBQUFxQixTQUR2RCxFQUVERCxFQUZDLENBRUUsWUFGRixFQUVnQixZQUFXO0FBQzFCWCxrQkFBTXZELEdBQUdvRSxLQUFILENBQVM5RCxDQUFmLENBQUQ7QUFDQStELG1CQUFPbkUsSUFBUCxDQUFZLElBQVosRUFBa0JGLEdBQUdvRSxLQUFILENBQVM5RCxDQUEzQjtBQUNBbUQscUJBQVNGLE1BQU1iLE1BQU4sQ0FBYTFDLEdBQUdvRSxLQUFILENBQVM5RCxDQUF0QixDQUFUO0FBQ0QsU0FOQyxDQVJWOztBQWdCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUEsWUFBSStELFNBQVNSLE9BQU9TLE1BQVAsQ0FBYyxRQUFkLEVBQXdCLGdCQUF4QixFQUNScEUsSUFEUSxDQUNILE9BREcsRUFDTSxRQUROLEVBRVJBLElBRlEsQ0FFSCxHQUZHLEVBRUUsQ0FGRixDQUFiOztBQUlBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQW1FLGVBQU9uRSxJQUFQLENBQVksSUFBWixFQUFrQkksRUFBRWtELGdCQUFnQixLQUFsQixDQUFsQjtBQUNBQyxpQkFBU0QsZ0JBQWdCLEtBQXpCO0FBRUgsS0F4RHdCO0FBQUEsQ0FBekIiLCJmaWxlIjoiYnVuZGxlLmpzIiwic291cmNlc0NvbnRlbnQiOlsiY29uc3QgSU5DT01FID0gNjAwMDAsXG4gICAgICBERURVQ1RJQkxFID0gNTAwMCxcbiAgICAgIFBSRU1JVU0gPSA2MDAsXG4gICAgICBFTVBMT1lFRCA9IHRydWU7XG5cbmNvbnN0IGN1cnJlbnRNb250aGx5ID0gKERFRFVDVElCTEUvMTIpICsgUFJFTUlVTTtcblxuJCgoKT0+e1xuXG5cbiAgY29uc3QgY29tcHV0ZUNvbnRyaWJ1dGlvbiA9IChkKSA9PiB7XG4gICAgaWYgKGQgPCAyNTAwMCkge1xuICAgICAgcmV0dXJuIDA7XG4gICAgfSBlbHNlIGlmIChkID49MjUwMDAgJiYgZCA8IDUwMDAwKXtcbiAgICAgIHJldHVybiAoZCAtIDI1MDAwKSAqIDAuMDkgLyAxMjtcbiAgICB9IGVsc2UgaWYgKGQgPj0gNTAwMDAgJiYgZCA8IDc1MDAwICkge1xuICAgICAgcmV0dXJuIChkLTI1MDAwKSAqIDAuMTEgLyAxMjtcbiAgICB9IGVsc2UgaWYgKCBkID49IDc1MDAwICYmIGQgPCAxMDAwMDApIHtcbiAgICAgIHJldHVybiAoZCAtIDI1MDAwKSAqIDAuMTIgLyAxMjtcbiAgICB9IGVsc2UgaWYgKCBkID49IDEwMDAwMCAmJiBkIDwgMjAwMDAwICkge1xuICAgICAgcmV0dXJuIChkIC0gMjUwMDApICogMC4xNCAvIDEyO1xuICAgIH0gZWxzZSB7XG4gICAgICByZXR1cm4gKGQgLSAyNTAwMCkgKiAwLjE2IC8gMTI7XG4gICAgfVxuICB9XG5cbiAgY29uc3QgY29tcHV0ZUVtcGxveWVyQ29udHJpYiA9IChkKSA9PiB7XG4gICAgcmV0dXJuIGNvbXB1dGVDb250cmlidXRpb24oZCkgKiAwLjg7XG4gIH1cblxuICBjb25zdCB1cGRhdGVDb250cmliVGV4dCA9IChkKSA9PiB7XG4gICAgY29uc3QgdG90YWxDb250cmlidXRpb24gPSBjb21wdXRlQ29udHJpYnV0aW9uKGQpO1xuICAgIGNvbnN0IHNlbGZTaGFyZSA9IHRvdGFsQ29udHJpYnV0aW9uICogMC4yICwgYm9zc1NoYXJlID0gdG90YWxDb250cmlidXRpb24gKiAwLjg7XG4gICAgY29uc3QgZGF0YSA9IGQzLnNlbGVjdChcIi5iYXJbc2VsZWN0ZWQ9dHJ1ZV1cIikuYXR0cihcImRhdGEtdmFsXCIpO1xuICAgIGNvbnN0IHBhZGRpbmcgPSA1O1xuICAgIGNvbnN0IHkgPSBjb250cmliU2NhbGUoY29tcHV0ZUNvbnRyaWJ1dGlvbihkYXRhKSk7XG4gICAgY29uc3QgeCA9IGluY29tZVNjYWxlKGRhdGEpO1xuXG5cblxuICAgIGJhclZhbHVlLmF0dHIoXCJ0cmFuc2Zvcm1cIixgdHJhbnNsYXRlKCR7eCAtICh0b3RhbENvbnRyaWJ1dGlvbiA8IGN1cnJlbnRNb250aGx5ID8gMzAgOiAwKX0sICR7eX0pYCk7XG4gICAgdmFyIHRleHRDaGlsZCA9IGJhclZhbHVlLnNlbGVjdChcInRleHRcIik7XG4gICAgdmFyIHJlY3RDaGlsZCA9IGJhclZhbHVlLnNlbGVjdChcInJlY3RcIilcbiAgICB2YXIgYmJveCA9IHRleHRDaGlsZC5ub2RlKCkuZ2V0QkJveCgpO1xuXG5cbiAgICByZWN0Q2hpbGQuYXR0cihcIndpZHRoXCIsIGJib3gud2lkdGggKyBwYWRkaW5nKVxuICAgICAgLmF0dHIoXCJoZWlnaHRcIiwgYmJveC5oZWlnaHQgKyBwYWRkaW5nKTtcblxuICAgIHRleHRDaGlsZC50ZXh0KGQzLmZvcm1hdChcIiQuMnNcIikocGFyc2VJbnQodG90YWxDb250cmlidXRpb24pKSk7XG5cbiAgfVxuICAvLzEuIFNob3cgYSBiYXIgY2hhcnRcblxuICAvLzIuIEJhciBjaGFydCBzaG91bGQgaGF2ZSBhIGd1aWRlIGF0IHRoZSB0b3Agb2YgaXRcblxuICAvLzMuIEhhdmUgYSBkcmFnZ2FibGUgc2xpZGVyXG5cblxuICB2YXIgc3ZnID0gZDMuc2VsZWN0KFwic3ZnI2NoYXJ0XCIpLFxuICAgICAgbWFyZ2luID0ge3RvcDogMjAsIHJpZ2h0OiA0MCwgYm90dG9tOiAzMCwgbGVmdDogMjB9LFxuICAgICAgd2lkdGggPSArc3ZnLmF0dHIoXCJ3aWR0aFwiKSAtIG1hcmdpbi5sZWZ0IC0gbWFyZ2luLnJpZ2h0LFxuICAgICAgaGVpZ2h0ID0gK3N2Zy5hdHRyKFwiaGVpZ2h0XCIpIC0gbWFyZ2luLnRvcCAtIG1hcmdpbi5ib3R0b20sXG4gICAgICBiYXJXaWR0aCA9IDE4LFxuICAgICAgYmFyR2FwID0gMjtcblxuXG4gIC8vIFNDQUxFU1xuICB2YXIgaW5jb21lU2NhbGUgPSBkMy5zY2FsZUxvZygpXG4gICAgICAgICAgICAgICAgICAgIC5kb21haW4oW01hdGgucG93KDEwLDQpLCA2ICogTWF0aC5wb3coMTAsNSldKVxuICAgICAgICAgICAgICAgICAgICAucmFuZ2UoWzAsIHdpZHRoXSk7XG4gIHZhciBjb250cmliU2NhbGUgPSBkMy5zY2FsZUxpbmVhcigpXG4gICAgICAgICAgICAgICAgICAgICAgICAuZG9tYWluKFswLCA3MDAwXSlcbiAgICAgICAgICAgICAgICAgICAgICAgIC5yYW5nZShbaGVpZ2h0LCAwXSk7XG5cbiAgLy8gQVhJU1xuICB2YXIgcGF5UG9pbnRzID0gWzEwMDAwLCAyNTAwMCwgNTAwMDAsIDYwMDAwLCA3NTAwMCwgMTAwMDAwLCAyMDAwMDAsIDMwMDAwMCwgNjAwMDAwXTtcbiAgdmFyIHhBeGlzID0gZDMuYXhpc0JvdHRvbShpbmNvbWVTY2FsZSlcbiAgICAgICAgICAgICAgICAudGlja1ZhbHVlcyhwYXlQb2ludHMpXG4gICAgICAgICAgICAgICAgLnRpY2tGb3JtYXQoKGQpPT5kMy5mb3JtYXQoXCIkLjFzXCIpKGQpKTtcblxuXG4gIC8vIEJBUlNcbiAgdmFyIGJhckNvdW50ID0gd2lkdGgvKGJhcldpZHRoICsgYmFyR2FwKTtcbiAgdmFyIGRhdGFQb2ludHMgPSBbXTtcblxuXG4gIC8vR2V0IGRhdGEgcG9pbnRzXG4gIHdoaWxlIChkYXRhUG9pbnRzLmxlbmd0aCAqIChiYXJXaWR0aCArIGJhckdhcCkgPCB3aWR0aCkge1xuICAgIHZhciB2YWx1ZSA9IGluY29tZVNjYWxlLmludmVydChkYXRhUG9pbnRzLmxlbmd0aCAqIChiYXJXaWR0aCArIGJhckdhcCkpO1xuICAgIGRhdGFQb2ludHMucHVzaChwYXJzZUludCh2YWx1ZSkpO1xuICB9XG5cblxuICB2YXIgeUF4aXMgPSBkMy5heGlzUmlnaHQoY29udHJpYlNjYWxlKVxuICAgICAgICAgICAgICAgIC50aWNrRm9ybWF0KChkKT0+ZDMuZm9ybWF0KFwiJC4yc1wiKShkKSk7XG5cbiAgLy9cblxuICBzdmcuYXBwZW5kKFwiZ1wiKVxuICAgICAgLmF0dHIoXCJjbGFzc1wiLFwieS0tYXhpcyB5LS1heGlzLS1tb250aGx5XCIpXG4gICAgICAuYXR0cihcInRyYW5zZm9ybVwiLCBgdHJhbnNsYXRlKCR7d2lkdGggKyBtYXJnaW4ubGVmdH0sICR7bWFyZ2luLnRvcH0pYClcbiAgICAgIC5jYWxsKHlBeGlzKTtcblxuICBzdmcuYXBwZW5kKFwiZ1wiKVxuICAgICAgLmF0dHIoXCJjbGFzc1wiLFwieC0tYXhpcyB4LS1heGlzLS1pbmNvbWVcIilcbiAgICAgIC5hdHRyKFwidHJhbnNmb3JtXCIsIGB0cmFuc2xhdGUoJHttYXJnaW4ubGVmdC8yfSwke2hlaWdodCArIG1hcmdpbi50b3B9KWApXG4gICAgICAuY2FsbCh4QXhpcyk7XG5cbiAgdmFyIGJhcnMgPSBzdmcuYXBwZW5kKFwiZ1wiKVxuICAgICAgICAgICAgICAgIC5hdHRyKFwidHJhbnNmb3JtXCIsIFwidHJhbnNsYXRlKFwiICsgbWFyZ2luLmxlZnQvMiArIFwiLFwiICsgbWFyZ2luLnRvcCArIFwiKVwiKTs7XG5cbiAgdmFyIGJhclZhbHVlID0gc3ZnLmFwcGVuZChcImdcIikuYXR0cihcImNsYXNzXCIsIFwiYmFyLS12YWx1ZS1jb250YWluZXJcIik7XG4gICAgICBiYXJWYWx1ZS5hcHBlbmQoXCJyZWN0XCIpLmF0dHIoXCJjbGFzc1wiLCBcImJhci1jb250YWluZXJcIik7XG4gICAgICBiYXJWYWx1ZS5hcHBlbmQoXCJ0ZXh0XCIpLmF0dHIoXCJjbGFzc1wiLCBcImJhci0tdmFsdWVcIilcblxuICAgICAgICAgICAgICAgICAgO1xuICAvL1xuXG4gIC8vIEJ1aWxkIHRoZSBiYXJzXG4gIHZhciBiYXJzSXRlbSA9IGJhcnMuc2VsZWN0QWxsKFwiLmJhclwiKVxuICAgICAgLmRhdGEoZGF0YVBvaW50cylcbiAgICAgIC5lbnRlcigpXG4gICAgICAgIC5hcHBlbmQoXCJnXCIpXG4gICAgICAgICAgLmF0dHIoXCJjbGFzc1wiLCBcImJhclwiKVxuICAgICAgICAgIC5hdHRyKFwiZGF0YS15XCIsIChkKT0+IGNvbnRyaWJTY2FsZShjb21wdXRlQ29udHJpYnV0aW9uKGQpKSlcbiAgICAgICAgICAuYXR0cihcImRhdGEtdmFsXCIsIChkKT0+ZCk7XG5cbiAgICAgIGJhcnNJdGVtLmFwcGVuZChcInJlY3RcIilcbiAgICAgICAgLmF0dHIoXCJjbGFzc1wiLCBcImNvbnRyaWJ1dGlvblwiKVxuICAgICAgICAuYXR0cihcInhcIiwgKGQsIGluZCkgPT4gaW5kICogKGJhcldpZHRoICsgYmFyR2FwKSlcbiAgICAgICAgLmF0dHIoXCJ5XCIsIChkKSA9PiB7XG4gICAgICAgICAgcmV0dXJuIGNvbnRyaWJTY2FsZShjb21wdXRlQ29udHJpYnV0aW9uKGQpKTtcbiAgICAgICAgfSlcbiAgICAgICAgLmF0dHIoXCJ3aWR0aFwiLCBiYXJXaWR0aClcbiAgICAgICAgLmF0dHIoXCJoZWlnaHRcIiwgKGQpID0+IGhlaWdodCAtIGNvbnRyaWJTY2FsZShjb21wdXRlQ29udHJpYnV0aW9uKGQpIC0gY29tcHV0ZUVtcGxveWVyQ29udHJpYihkKSkpXG5cbiAgICAgIGJhcnNJdGVtLmFwcGVuZChcInJlY3RcIilcbiAgICAgICAgLmF0dHIoXCJjbGFzc1wiLCBcImVtcGxveWVyXCIpXG4gICAgICAgIC5hdHRyKFwieFwiLCAoZCwgaW5kKSA9PiBpbmQgKiAoYmFyV2lkdGggKyBiYXJHYXApKVxuICAgICAgICAuYXR0cihcInlcIiwgKGQpID0+IHtcbiAgICAgICAgICByZXR1cm4gY29udHJpYlNjYWxlKGNvbXB1dGVFbXBsb3llckNvbnRyaWIoZCkpO1xuICAgICAgICB9KVxuICAgICAgICAuYXR0cihcIndpZHRoXCIsIGJhcldpZHRoKVxuICAgICAgICAuYXR0cihcImhlaWdodFwiLCAoZCkgPT4gaGVpZ2h0IC0gY29udHJpYlNjYWxlKGNvbXB1dGVFbXBsb3llckNvbnRyaWIoZCkpKVxuICAvL1xuXG4gIHZhciBjb250YWluZXIgPVxuICAgIHN2Z1xuICAgICAgLmFwcGVuZChcImdcIilcbiAgICAgIC5hdHRyKFwiY2xhc3NcIiwgXCJob3Jpem9udGFsLS1zbGlkZXJcIilcbiAgICAgIC5hdHRyKFwidHJhbnNmb3JtXCIsIGB0cmFuc2xhdGUoJHttYXJnaW4ubGVmdC8yfSwgJHtoZWlnaHQgKyBtYXJnaW4udG9wfSlgKTtcblxuICBjb250YWluZXIuY2FsbChjYWxjdWxhdG9yU2xpZGVyKHtcbiAgICBzY2FsZTogaW5jb21lU2NhbGUsXG4gICAgaW5pdGlhbFZhbHVlOiBJTkNPTUUsXG4gICAgY2FsbGJhY2s6ICh2YWx1ZSkgPT4ge1xuICAgICAgdmFyIHNlbGVjdGVkSXRlbSA9IE1hdGguZmxvb3IoaW5jb21lU2NhbGUodmFsdWUpLyhiYXJXaWR0aCtiYXJHYXApKTtcbiAgICAgIGJhcnNJdGVtLmF0dHIoXCJzZWxlY3RlZFwiLCAoZCwgaW5kKSA9PiBzZWxlY3RlZEl0ZW0gPT09IGluZCk7XG4gICAgICB1cGRhdGVDb250cmliVGV4dCh2YWx1ZSk7XG4gICAgfVxuICB9KSk7XG4gIHVwZGF0ZUNvbnRyaWJUZXh0KElOQ09NRSk7XG5cbiAgc3ZnLmFwcGVuZChcImdcIilcbiAgICAgICAgLmF0dHIoXCJ0cmFuc2Zvcm1cIiwgXCJ0cmFuc2xhdGUoXCIgKyBtYXJnaW4ubGVmdC8yICsgXCIsXCIgKyBtYXJnaW4udG9wICsgXCIpXCIpXG4gICAgICAgIC5hcHBlbmQoXCJyZWN0XCIpXG4gICAgICAgIC5hdHRyKFwiY2xhc3NcIiwgXCJjdXJyZW50LWV4cGVuc2VcIilcbiAgICAgICAgLmF0dHIoXCJ4XCIsIDApXG4gICAgICAgIC5hdHRyKFwid2lkdGhcIiwgd2lkdGgpXG4gICAgICAgIC5hdHRyKFwiaGVpZ2h0XCIsIDEpXG4gICAgICAgIC5hdHRyKFwieVwiLCBjb250cmliU2NhbGUoY3VycmVudE1vbnRobHkpKVxufSk7XG4iLCJcbmNvbnN0IGNhbGN1bGF0b3JTbGlkZXIgPSAoe1xuICAgIHNjYWxlLFxuICAgIGNhbGxiYWNrLFxuICAgIGluaXRpYWxWYWx1ZSxcbiAgfSkgPT4gKGNvbnRhaW5lcikgPT4ge1xuXG4gICAgdmFyIHggPSBzY2FsZS5jbGFtcCh0cnVlKTtcblxuICAgICh4KTtcblxuICAgIHZhciBzbGlkZXIgPSBjb250YWluZXIuYXBwZW5kKFwiZ1wiKVxuICAgICAgICAuYXR0cihcImNsYXNzXCIsIFwic2xpZGVyXCIpICA7XG5cbiAgICBzbGlkZXIuYXBwZW5kKFwibGluZVwiKVxuICAgICAgICAuYXR0cihcImNsYXNzXCIsIFwidHJhY2tcIilcbiAgICAgICAgLmF0dHIoXCJ4MVwiLCB4LnJhbmdlKClbMF0pXG4gICAgICAgIC5hdHRyKFwieDJcIiwgeC5yYW5nZSgpWzFdKVxuICAgICAgLnNlbGVjdChmdW5jdGlvbigpIHsgcmV0dXJuIHRoaXMucGFyZW50Tm9kZS5hcHBlbmRDaGlsZCh0aGlzLmNsb25lTm9kZSh0cnVlKSk7IH0pXG4gICAgICAgIC5hdHRyKFwiY2xhc3NcIiwgXCJ0cmFjay1pbnNldFwiKVxuICAgICAgLnNlbGVjdChmdW5jdGlvbigpIHsgcmV0dXJuIHRoaXMucGFyZW50Tm9kZS5hcHBlbmRDaGlsZCh0aGlzLmNsb25lTm9kZSh0cnVlKSk7IH0pXG4gICAgICAgIC5hdHRyKFwiY2xhc3NcIiwgXCJ0cmFjay1vdmVybGF5XCIpXG4gICAgICAgIC5jYWxsKGQzLmRyYWcoKVxuICAgICAgICAgICAgLm9uKFwic3RhcnQuaW50ZXJydXB0XCIsIGZ1bmN0aW9uKCkgeyBzbGlkZXIuaW50ZXJydXB0KCk7IH0pXG4gICAgICAgICAgICAub24oXCJzdGFydCBkcmFnXCIsIGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAoc2NhbGUoZDMuZXZlbnQueCkpXG4gICAgICAgICAgICAgIGhhbmRsZS5hdHRyKFwiY3hcIiwgZDMuZXZlbnQueCk7XG4gICAgICAgICAgICAgIGNhbGxiYWNrKHNjYWxlLmludmVydChkMy5ldmVudC54KSk7XG4gICAgICAgICAgICB9KSk7XG5cbiAgICAvLyBzbGlkZXIuaW5zZXJ0KFwiZ1wiLCBcIi50cmFjay1vdmVybGF5XCIpXG4gICAgLy8gICAgIC5hdHRyKFwiY2xhc3NcIiwgXCJ0aWNrc1wiKVxuICAgIC8vICAgICAuYXR0cihcInRyYW5zZm9ybVwiLCBcInRyYW5zbGF0ZSgwLFwiICsgMTggKyBcIilcIilcbiAgICAvLyAgIC5zZWxlY3RBbGwoXCJ0ZXh0XCIpXG4gICAgLy8gICAuZGF0YSh4LnRpY2tzKDEwKSlcbiAgICAvLyAgIC5lbnRlcigpLmFwcGVuZChcInRleHRcIilcbiAgICAvLyAgICAgLmF0dHIoXCJ4XCIsIHgpXG4gICAgLy8gICAgIC5hdHRyKFwidGV4dC1hbmNob3JcIiwgXCJtaWRkbGVcIilcbiAgICAvLyAgICAgLnRleHQoZnVuY3Rpb24oZCkgeyByZXR1cm4gZDsgfSk7XG5cbiAgICB2YXIgaGFuZGxlID0gc2xpZGVyLmluc2VydChcImNpcmNsZVwiLCBcIi50cmFjay1vdmVybGF5XCIpXG4gICAgICAgIC5hdHRyKFwiY2xhc3NcIiwgXCJoYW5kbGVcIilcbiAgICAgICAgLmF0dHIoXCJyXCIsIDkpO1xuXG4gICAgLy8gc2xpZGVyLnRyYW5zaXRpb24oKSAvLyBHcmF0dWl0b3VzIGludHJvIVxuICAgIC8vICAgICAuZHVyYXRpb24oNzUwKVxuICAgIC8vICAgICAudHdlZW4oXCJodWVcIiwgZnVuY3Rpb24oKSB7XG4gICAgLy8gICAgICAgdmFyIGkgPSBkMy5pbnRlcnBvbGF0ZSgwLCA3MCk7XG4gICAgLy8gICAgICAgcmV0dXJuIGZ1bmN0aW9uKHQpIHtcbiAgICAvLyAgICAgICAgIGhhbmRsZS5hdHRyKFwiY3hcIiwgeCh0KSk7XG4gICAgLy8gICAgICAgICBjYWxsYmFjayhpKHQpKTtcbiAgICAvLyAgICAgICB9O1xuICAgIC8vICAgICB9KTtcblxuICAgIGhhbmRsZS5hdHRyKFwiY3hcIiwgeChpbml0aWFsVmFsdWUgfHwgNjAwMDApKVxuICAgIGNhbGxiYWNrKGluaXRpYWxWYWx1ZSB8fCA2MDAwMClcblxufTtcbiJdfQ==
