"use strict";

var INCOME = 60000,
    DEDUCTIBLE = 5000,
    PREMIUM = 600,
    EMPLOYED = true;
$(function () {

  var computeContribution = function computeContribution(d) {
    if (d < 25000) {
      return 0;
    } else if (d >= 25000 && d < 50000) {
      return (d - 25000) * 0.09 / 12;
    } else if (d >= 50000 && d < 75000) {
      return (d - 25000) * 0.11 / 12;
    } else if (d >= 75000 && d < 100000) {
      return (d - 25000) * 0.12 / 12;
    } else if (d >= 100000 && d < 200000) {
      return (d - 25000) * 0.14 / 12;
    } else {
      return (d - 25000) * 0.16 / 12;
    }
  };

  var computeEmployerContrib = function computeEmployerContrib(d) {
    return computeContribution(d) * 0.8;
  };

  var updateContribText = function updateContribText(d) {
    var totalContribution = computeContribution(d);
    var selfShare = totalContribution * 0.2,
        bossShare = totalContribution * 0.8;
    var data = d3.select(".bar[selected=true]").attr("data-val");
    var padding = 5;
    var y = contribScale(computeContribution(data));
    var x = incomeScale(data);

    console.log("XX", data, y);

    barValue.attr("transform", "translate(" + x + ", " + y + ")");
    var textChild = barValue.select("text");
    var rectChild = barValue.select("rect");
    var bbox = textChild.node().getBBox();

    console.log(bbox);
    rectChild.attr("width", bbox.width + padding).attr("height", bbox.height + padding);

    textChild.text(d3.format("$.2s")(parseInt(totalContribution)));
  };
  //1. Show a bar chart

  //2. Bar chart should have a guide at the top of it

  //3. Have a draggable slider


  var svg = d3.select("svg#chart"),
      margin = { top: 20, right: 40, bottom: 30, left: 20 },
      width = +svg.attr("width") - margin.left - margin.right,
      height = +svg.attr("height") - margin.top - margin.bottom,
      barWidth = 18,
      barGap = 2;

  console.log(svg.attr("width"));
  // SCALES
  var incomeScale = d3.scaleLog().domain([Math.pow(10, 4), 6 * Math.pow(10, 5)]).range([0, width]);
  var contribScale = d3.scaleLinear().domain([0, 7000]).range([height, 0]);

  // AXIS
  var payPoints = [10000, 25000, 50000, 60000, 75000, 100000, 200000, 300000, 600000];
  var xAxis = d3.axisBottom(incomeScale).tickValues(payPoints).tickFormat(function (d) {
    return d3.format("$.1s")(d);
  });

  // BARS
  var barCount = width / (barWidth + barGap);
  var dataPoints = [];

  var currentMonthly = contribScale(DEDUCTIBLE / 12 + PREMIUM);

  //Get data points
  while (dataPoints.length * (barWidth + barGap) < width) {
    var value = incomeScale.invert(dataPoints.length * (barWidth + barGap));
    dataPoints.push(parseInt(value));
  }

  var yAxis = d3.axisRight(contribScale).tickFormat(function (d) {
    return d3.format("$.2s")(d);
  });

  // console.log("FINAL", dataPoints);

  svg.append("g").attr("class", "y--axis y--axis--monthly").attr("transform", "translate(" + (width + margin.left) + ", " + margin.top + ")").call(yAxis);

  svg.append("g").attr("class", "x--axis x--axis--income").attr("transform", "translate(" + margin.left / 2 + "," + (height + margin.top) + ")").call(xAxis);

  var bars = svg.append("g").attr("transform", "translate(" + margin.left / 2 + "," + margin.top + ")");;

  var barValue = svg.append("g").attr("class", "bar--value-container");
  barValue.append("rect").attr("class", "bar-container");
  barValue.append("text").attr("class", "bar--value");
  console.log(barValue.select("text"));
  //

  // Build the bars
  var barsItem = bars.selectAll(".bar").data(dataPoints).enter().append("g").attr("class", "bar").attr("data-y", function (d) {
    return contribScale(computeContribution(d));
  }).attr("data-val", function (d) {
    return d;
  });

  barsItem.append("rect").attr("class", "contribution").attr("x", function (d, ind) {
    return ind * (barWidth + barGap);
  }).attr("y", function (d) {
    return contribScale(computeContribution(d));
  }).attr("width", barWidth).attr("height", function (d) {
    return height - contribScale(computeContribution(d) - computeEmployerContrib(d));
  });

  barsItem.append("rect").attr("class", "employer").attr("x", function (d, ind) {
    return ind * (barWidth + barGap);
  }).attr("y", function (d) {
    return contribScale(computeEmployerContrib(d));
  }).attr("width", barWidth).attr("height", function (d) {
    return height - contribScale(computeEmployerContrib(d));
  });
  // console.log(incomeScale);

  var container = svg.append("g").attr("class", "horizontal--slider").attr("transform", "translate(" + margin.left / 2 + ", " + (height + margin.top) + ")");

  container.call(calculatorSlider({
    scale: incomeScale,
    initialValue: INCOME,
    callback: function callback(value) {
      var selectedItem = Math.floor(incomeScale(value) / (barWidth + barGap));
      barsItem.attr("selected", function (d, ind) {
        return selectedItem === ind;
      });
      updateContribText(value);
    }
  }));
  updateContribText(INCOME);

  svg.append("g").attr("transform", "translate(" + margin.left / 2 + "," + margin.top + ")").append("rect").attr("class", "current-expense").attr("x", 0).attr("width", width).attr("height", 1).attr("y", currentMonthly);
});
"use strict";

var calculatorSlider = function calculatorSlider(_ref) {
    var scale = _ref.scale,
        callback = _ref.callback,
        initialValue = _ref.initialValue;
    return function (container) {

        var x = scale.clamp(true);

        console.log(x);

        var slider = container.append("g").attr("class", "slider");

        slider.append("line").attr("class", "track").attr("x1", x.range()[0]).attr("x2", x.range()[1]).select(function () {
            return this.parentNode.appendChild(this.cloneNode(true));
        }).attr("class", "track-inset").select(function () {
            return this.parentNode.appendChild(this.cloneNode(true));
        }).attr("class", "track-overlay").call(d3.drag().on("start.interrupt", function () {
            slider.interrupt();
        }).on("start drag", function () {
            console.log(scale(d3.event.x));
            handle.attr("cx", d3.event.x);
            callback(scale.invert(d3.event.x));
        }));

        // slider.insert("g", ".track-overlay")
        //     .attr("class", "ticks")
        //     .attr("transform", "translate(0," + 18 + ")")
        //   .selectAll("text")
        //   .data(x.ticks(10))
        //   .enter().append("text")
        //     .attr("x", x)
        //     .attr("text-anchor", "middle")
        //     .text(function(d) { return d; });

        var handle = slider.insert("circle", ".track-overlay").attr("class", "handle").attr("r", 9);

        // slider.transition() // Gratuitous intro!
        //     .duration(750)
        //     .tween("hue", function() {
        //       var i = d3.interpolate(0, 70);
        //       return function(t) {
        //         handle.attr("cx", x(t));
        //         callback(i(t));
        //       };
        //     });

        handle.attr("cx", x(initialValue || 60000));
        callback(initialValue || 60000);
    };
};
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFwcC5qcyIsImxpYi9zbGlkZXIuanMiXSwibmFtZXMiOlsiSU5DT01FIiwiREVEVUNUSUJMRSIsIlBSRU1JVU0iLCJFTVBMT1lFRCIsIiQiLCJjb21wdXRlQ29udHJpYnV0aW9uIiwiZCIsImNvbXB1dGVFbXBsb3llckNvbnRyaWIiLCJ1cGRhdGVDb250cmliVGV4dCIsInRvdGFsQ29udHJpYnV0aW9uIiwic2VsZlNoYXJlIiwiYm9zc1NoYXJlIiwiZGF0YSIsImQzIiwic2VsZWN0IiwiYXR0ciIsInBhZGRpbmciLCJ5IiwiY29udHJpYlNjYWxlIiwieCIsImluY29tZVNjYWxlIiwiY29uc29sZSIsImxvZyIsImJhclZhbHVlIiwidGV4dENoaWxkIiwicmVjdENoaWxkIiwiYmJveCIsIm5vZGUiLCJnZXRCQm94Iiwid2lkdGgiLCJoZWlnaHQiLCJ0ZXh0IiwiZm9ybWF0IiwicGFyc2VJbnQiLCJzdmciLCJtYXJnaW4iLCJ0b3AiLCJyaWdodCIsImJvdHRvbSIsImxlZnQiLCJiYXJXaWR0aCIsImJhckdhcCIsInNjYWxlTG9nIiwiZG9tYWluIiwiTWF0aCIsInBvdyIsInJhbmdlIiwic2NhbGVMaW5lYXIiLCJwYXlQb2ludHMiLCJ4QXhpcyIsImF4aXNCb3R0b20iLCJ0aWNrVmFsdWVzIiwidGlja0Zvcm1hdCIsImJhckNvdW50IiwiZGF0YVBvaW50cyIsImN1cnJlbnRNb250aGx5IiwibGVuZ3RoIiwidmFsdWUiLCJpbnZlcnQiLCJwdXNoIiwieUF4aXMiLCJheGlzUmlnaHQiLCJhcHBlbmQiLCJjYWxsIiwiYmFycyIsImJhcnNJdGVtIiwic2VsZWN0QWxsIiwiZW50ZXIiLCJpbmQiLCJjb250YWluZXIiLCJjYWxjdWxhdG9yU2xpZGVyIiwic2NhbGUiLCJpbml0aWFsVmFsdWUiLCJjYWxsYmFjayIsInNlbGVjdGVkSXRlbSIsImZsb29yIiwiY2xhbXAiLCJzbGlkZXIiLCJwYXJlbnROb2RlIiwiYXBwZW5kQ2hpbGQiLCJjbG9uZU5vZGUiLCJkcmFnIiwi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QkFBZ0IsS0FBekI7QUFFSCxLQXhEd0I7QUFBQSxDQUF6QiIsImZpbGUiOiJidW5kbGUuanMiLCJzb3VyY2VzQ29udGVudCI6WyJjb25zdCBJTkNPTUUgPSA2MDAwMCxcbiAgICAgIERFRFVDVElCTEUgPSA1MDAwLFxuICAgICAgUFJFTUlVTSA9IDYwMCxcbiAgICAgIEVNUExPWUVEID0gdHJ1ZTtcbiQoKCk9PntcblxuXG4gIGNvbnN0IGNvbXB1dGVDb250cmlidXRpb24gPSAoZCkgPT4ge1xuICAgIGlmIChkIDwgMjUwMDApIHtcbiAgICAgIHJldHVybiAwO1xuICAgIH0gZWxzZSBpZiAoZCA+PTI1MDAwICYmIGQgPCA1MDAwMCl7XG4gICAgICByZXR1cm4gKGQgLSAyNTAwMCkgKiAwLjA5IC8gMTI7XG4gICAgfSBlbHNlIGlmIChkID49IDUwMDAwICYmIGQgPCA3NTAwMCApIHtcbiAgICAgIHJldHVybiAoZC0yNTAwMCkgKiAwLjExIC8gMTI7XG4gICAgfSBlbHNlIGlmICggZCA+PSA3NTAwMCAmJiBkIDwgMTAwMDAwKSB7XG4gICAgICByZXR1cm4gKGQgLSAyNTAwMCkgKiAwLjEyIC8gMTI7XG4gICAgfSBlbHNlIGlmICggZCA+PSAxMDAwMDAgJiYgZCA8IDIwMDAwMCApIHtcbiAgICAgIHJldHVybiAoZCAtIDI1MDAwKSAqIDAuMTQgLyAxMjtcbiAgICB9IGVsc2Uge1xuICAgICAgcmV0dXJuIChkIC0gMjUwMDApICogMC4xNiAvIDEyO1xuICAgIH1cbiAgfVxuXG4gIGNvbnN0IGNvbXB1dGVFbXBsb3llckNvbnRyaWIgPSAoZCkgPT4ge1xuICAgIHJldHVybiBjb21wdXRlQ29udHJpYnV0aW9uKGQpICogMC44O1xuICB9XG5cbiAgY29uc3QgdXBkYXRlQ29udHJpYlRleHQgPSAoZCkgPT4ge1xuICAgIGNvbnN0IHRvdGFsQ29udHJpYnV0aW9uID0gY29tcHV0ZUNvbnRyaWJ1dGlvbihkKTtcbiAgICBjb25zdCBzZWxmU2hhcmUgPSB0b3RhbENvbnRyaWJ1dGlvbiAqIDAuMiAsIGJvc3NTaGFyZSA9IHRvdGFsQ29udHJpYnV0aW9uICogMC44O1xuICAgIGNvbnN0IGRhdGEgPSBkMy5zZWxlY3QoXCIuYmFyW3NlbGVjdGVkPXRydWVdXCIpLmF0dHIoXCJkYXRhLXZhbFwiKTtcbiAgICBjb25zdCBwYWRkaW5nID0gNTtcbiAgICBjb25zdCB5ID0gY29udHJpYlNjYWxlKGNvbXB1dGVDb250cmlidXRpb24oZGF0YSkpO1xuICAgIGNvbnN0IHggPSBpbmNvbWVTY2FsZShkYXRhKTtcblxuICAgIGNvbnNvbGUubG9nKFwiWFhcIiwgZGF0YSwgeSk7XG5cbiAgICBiYXJWYWx1ZS5hdHRyKFwidHJhbnNmb3JtXCIsYHRyYW5zbGF0ZSgke3h9LCAke3l9KWApO1xuICAgIHZhciB0ZXh0Q2hpbGQgPSBiYXJWYWx1ZS5zZWxlY3QoXCJ0ZXh0XCIpO1xuICAgIHZhciByZWN0Q2hpbGQgPSBiYXJWYWx1ZS5zZWxlY3QoXCJyZWN0XCIpXG4gICAgdmFyIGJib3ggPSB0ZXh0Q2hpbGQubm9kZSgpLmdldEJCb3goKTtcblxuICAgIGNvbnNvbGUubG9nKGJib3gpO1xuICAgIHJlY3RDaGlsZC5hdHRyKFwid2lkdGhcIiwgYmJveC53aWR0aCArIHBhZGRpbmcpXG4gICAgICAuYXR0cihcImhlaWdodFwiLCBiYm94LmhlaWdodCArIHBhZGRpbmcpO1xuXG4gICAgdGV4dENoaWxkLnRleHQoZDMuZm9ybWF0KFwiJC4yc1wiKShwYXJzZUludCh0b3RhbENvbnRyaWJ1dGlvbikpKTtcblxuICB9XG4gIC8vMS4gU2hvdyBhIGJhciBjaGFydFxuXG4gIC8vMi4gQmFyIGNoYXJ0IHNob3VsZCBoYXZlIGEgZ3VpZGUgYXQgdGhlIHRvcCBvZiBpdFxuXG4gIC8vMy4gSGF2ZSBhIGRyYWdnYWJsZSBzbGlkZXJcblxuXG4gIHZhciBzdmcgPSBkMy5zZWxlY3QoXCJzdmcjY2hhcnRcIiksXG4gICAgICBtYXJnaW4gPSB7dG9wOiAyMCwgcmlnaHQ6IDQwLCBib3R0b206IDMwLCBsZWZ0OiAyMH0sXG4gICAgICB3aWR0aCA9ICtzdmcuYXR0cihcIndpZHRoXCIpIC0gbWFyZ2luLmxlZnQgLSBtYXJnaW4ucmlnaHQsXG4gICAgICBoZWlnaHQgPSArc3ZnLmF0dHIoXCJoZWlnaHRcIikgLSBtYXJnaW4udG9wIC0gbWFyZ2luLmJvdHRvbSxcbiAgICAgIGJhcldpZHRoID0gMTgsXG4gICAgICBiYXJHYXAgPSAyO1xuXG4gIGNvbnNvbGUubG9nKHN2Zy5hdHRyKFwid2lkdGhcIikpO1xuICAvLyBTQ0FMRVNcbiAgdmFyIGluY29tZVNjYWxlID0gZDMuc2NhbGVMb2coKVxuICAgICAgICAgICAgICAgICAgICAuZG9tYWluKFtNYXRoLnBvdygxMCw0KSwgNiAqIE1hdGgucG93KDEwLDUpXSlcbiAgICAgICAgICAgICAgICAgICAgLnJhbmdlKFswLCB3aWR0aF0pO1xuICB2YXIgY29udHJpYlNjYWxlID0gZDMuc2NhbGVMaW5lYXIoKVxuICAgICAgICAgICAgICAgICAgICAgICAgLmRvbWFpbihbMCwgNzAwMF0pXG4gICAgICAgICAgICAgICAgICAgICAgICAucmFuZ2UoW2hlaWdodCwgMF0pO1xuXG4gIC8vIEFYSVNcbiAgdmFyIHBheVBvaW50cyA9IFsxMDAwMCwgMjUwMDAsIDUwMDAwLCA2MDAwMCwgNzUwMDAsIDEwMDAwMCwgMjAwMDAwLCAzMDAwMDAsIDYwMDAwMF07XG4gIHZhciB4QXhpcyA9IGQzLmF4aXNCb3R0b20oaW5jb21lU2NhbGUpXG4gICAgICAgICAgICAgICAgLnRpY2tWYWx1ZXMocGF5UG9pbnRzKVxuICAgICAgICAgICAgICAgIC50aWNrRm9ybWF0KChkKT0+ZDMuZm9ybWF0KFwiJC4xc1wiKShkKSk7XG5cblxuICAvLyBCQVJTXG4gIHZhciBiYXJDb3VudCA9IHdpZHRoLyhiYXJXaWR0aCArIGJhckdhcCk7XG4gIHZhciBkYXRhUG9pbnRzID0gW107XG5cbiAgY29uc3QgY3VycmVudE1vbnRobHkgPSBjb250cmliU2NhbGUoKERFRFVDVElCTEUvMTIpICsgUFJFTUlVTSk7XG5cbiAgLy9HZXQgZGF0YSBwb2ludHNcbiAgd2hpbGUgKGRhdGFQb2ludHMubGVuZ3RoICogKGJhcldpZHRoICsgYmFyR2FwKSA8IHdpZHRoKSB7XG4gICAgdmFyIHZhbHVlID0gaW5jb21lU2NhbGUuaW52ZXJ0KGRhdGFQb2ludHMubGVuZ3RoICogKGJhcldpZHRoICsgYmFyR2FwKSk7XG4gICAgZGF0YVBvaW50cy5wdXNoKHBhcnNlSW50KHZhbHVlKSk7XG4gIH1cblxuXG4gIHZhciB5QXhpcyA9IGQzLmF4aXNSaWdodChjb250cmliU2NhbGUpXG4gICAgICAgICAgICAgICAgLnRpY2tGb3JtYXQoKGQpPT5kMy5mb3JtYXQoXCIkLjJzXCIpKGQpKTtcblxuICAvLyBjb25zb2xlLmxvZyhcIkZJTkFMXCIsIGRhdGFQb2ludHMpO1xuXG4gIHN2Zy5hcHBlbmQoXCJnXCIpXG4gICAgICAuYXR0cihcImNsYXNzXCIsXCJ5LS1heGlzIHktLWF4aXMtLW1vbnRobHlcIilcbiAgICAgIC5hdHRyKFwidHJhbnNmb3JtXCIsIGB0cmFuc2xhdGUoJHt3aWR0aCArIG1hcmdpbi5sZWZ0fSwgJHttYXJnaW4udG9wfSlgKVxuICAgICAgLmNhbGwoeUF4aXMpO1xuXG4gIHN2Zy5hcHBlbmQoXCJnXCIpXG4gICAgICAuYXR0cihcImNsYXNzXCIsXCJ4LS1heGlzIHgtLWF4aXMtLWluY29tZVwiKVxuICAgICAgLmF0dHIoXCJ0cmFuc2Zvcm1cIiwgYHRyYW5zbGF0ZSgke21hcmdpbi5sZWZ0LzJ9LCR7aGVpZ2h0ICsgbWFyZ2luLnRvcH0pYClcbiAgICAgIC5jYWxsKHhBeGlzKTtcblxuICB2YXIgYmFycyA9IHN2Zy5hcHBlbmQoXCJnXCIpXG4gICAgICAgICAgICAgICAgLmF0dHIoXCJ0cmFuc2Zvcm1cIiwgXCJ0cmFuc2xhdGUoXCIgKyBtYXJnaW4ubGVmdC8yICsgXCIsXCIgKyBtYXJnaW4udG9wICsgXCIpXCIpOztcblxuICB2YXIgYmFyVmFsdWUgPSBzdmcuYXBwZW5kKFwiZ1wiKS5hdHRyKFwiY2xhc3NcIiwgXCJiYXItLXZhbHVlLWNvbnRhaW5lclwiKTtcbiAgICAgIGJhclZhbHVlLmFwcGVuZChcInJlY3RcIikuYXR0cihcImNsYXNzXCIsIFwiYmFyLWNvbnRhaW5lclwiKTtcbiAgICAgIGJhclZhbHVlLmFwcGVuZChcInRleHRcIikuYXR0cihcImNsYXNzXCIsIFwiYmFyLS12YWx1ZVwiKVxuICAgICAgY29uc29sZS5sb2coYmFyVmFsdWUuc2VsZWN0KFwidGV4dFwiKSlcbiAgICAgICAgICAgICAgICAgIDtcbiAgLy9cblxuICAvLyBCdWlsZCB0aGUgYmFyc1xuICB2YXIgYmFyc0l0ZW0gPSBiYXJzLnNlbGVjdEFsbChcIi5iYXJcIilcbiAgICAgIC5kYXRhKGRhdGFQb2ludHMpXG4gICAgICAuZW50ZXIoKVxuICAgICAgICAuYXBwZW5kKFwiZ1wiKVxuICAgICAgICAgIC5hdHRyKFwiY2xhc3NcIiwgXCJiYXJcIilcbiAgICAgICAgICAuYXR0cihcImRhdGEteVwiLCAoZCk9PiBjb250cmliU2NhbGUoY29tcHV0ZUNvbnRyaWJ1dGlvbihkKSkpXG4gICAgICAgICAgLmF0dHIoXCJkYXRhLXZhbFwiLCAoZCk9PmQpO1xuXG4gICAgICBiYXJzSXRlbS5hcHBlbmQoXCJyZWN0XCIpXG4gICAgICAgIC5hdHRyKFwiY2xhc3NcIiwgXCJjb250cmlidXRpb25cIilcbiAgICAgICAgLmF0dHIoXCJ4XCIsIChkLCBpbmQpID0+IGluZCAqIChiYXJXaWR0aCArIGJhckdhcCkpXG4gICAgICAgIC5hdHRyKFwieVwiLCAoZCkgPT4ge1xuICAgICAgICAgIHJldHVybiBjb250cmliU2NhbGUoY29tcHV0ZUNvbnRyaWJ1dGlvbihkKSk7XG4gICAgICAgIH0pXG4gICAgICAgIC5hdHRyKFwid2lkdGhcIiwgYmFyV2lkdGgpXG4gICAgICAgIC5hdHRyKFwiaGVpZ2h0XCIsIChkKSA9PiBoZWlnaHQgLSBjb250cmliU2NhbGUoY29tcHV0ZUNvbnRyaWJ1dGlvbihkKSAtIGNvbXB1dGVFbXBsb3llckNvbnRyaWIoZCkpKVxuXG4gICAgICBiYXJzSXRlbS5hcHBlbmQoXCJyZWN0XCIpXG4gICAgICAgIC5hdHRyKFwiY2xhc3NcIiwgXCJlbXBsb3llclwiKVxuICAgICAgICAuYXR0cihcInhcIiwgKGQsIGluZCkgPT4gaW5kICogKGJhcldpZHRoICsgYmFyR2FwKSlcbiAgICAgICAgLmF0dHIoXCJ5XCIsIChkKSA9PiB7XG4gICAgICAgICAgcmV0dXJuIGNvbnRyaWJTY2FsZShjb21wdXRlRW1wbG95ZXJDb250cmliKGQpKTtcbiAgICAgICAgfSlcbiAgICAgICAgLmF0dHIoXCJ3aWR0aFwiLCBiYXJXaWR0aClcbiAgICAgICAgLmF0dHIoXCJoZWlnaHRcIiwgKGQpID0+IGhlaWdodCAtIGNvbnRyaWJTY2FsZShjb21wdXRlRW1wbG95ZXJDb250cmliKGQpKSlcbiAgLy8gY29uc29sZS5sb2coaW5jb21lU2NhbGUpO1xuXG4gIHZhciBjb250YWluZXIgPVxuICAgIHN2Z1xuICAgICAgLmFwcGVuZChcImdcIilcbiAgICAgIC5hdHRyKFwiY2xhc3NcIiwgXCJob3Jpem9udGFsLS1zbGlkZXJcIilcbiAgICAgIC5hdHRyKFwidHJhbnNmb3JtXCIsIGB0cmFuc2xhdGUoJHttYXJnaW4ubGVmdC8yfSwgJHtoZWlnaHQgKyBtYXJnaW4udG9wfSlgKTtcblxuICBjb250YWluZXIuY2FsbChjYWxjdWxhdG9yU2xpZGVyKHtcbiAgICBzY2FsZTogaW5jb21lU2NhbGUsXG4gICAgaW5pdGlhbFZhbHVlOiBJTkNPTUUsXG4gICAgY2FsbGJhY2s6ICh2YWx1ZSkgPT4ge1xuICAgICAgdmFyIHNlbGVjdGVkSXRlbSA9IE1hdGguZmxvb3IoaW5jb21lU2NhbGUodmFsdWUpLyhiYXJXaWR0aCtiYXJHYXApKTtcbiAgICAgIGJhcnNJdGVtLmF0dHIoXCJzZWxlY3RlZFwiLCAoZCwgaW5kKSA9PiBzZWxlY3RlZEl0ZW0gPT09IGluZCk7XG4gICAgICB1cGRhdGVDb250cmliVGV4dCh2YWx1ZSk7XG4gICAgfVxuICB9KSk7XG4gIHVwZGF0ZUNvbnRyaWJUZXh0KElOQ09NRSk7XG5cbiAgc3ZnLmFwcGVuZChcImdcIilcbiAgICAgICAgLmF0dHIoXCJ0cmFuc2Zvcm1cIiwgXCJ0cmFuc2xhdGUoXCIgKyBtYXJnaW4ubGVmdC8yICsgXCIsXCIgKyBtYXJnaW4udG9wICsgXCIpXCIpXG4gICAgICAgIC5hcHBlbmQoXCJyZWN0XCIpXG4gICAgICAgIC5hdHRyKFwiY2xhc3NcIiwgXCJjdXJyZW50LWV4cGVuc2VcIilcbiAgICAgICAgLmF0dHIoXCJ4XCIsIDApXG4gICAgICAgIC5hdHRyKFwid2lkdGhcIiwgd2lkdGgpXG4gICAgICAgIC5hdHRyKFwiaGVpZ2h0XCIsIDEpXG4gICAgICAgIC5hdHRyKFwieVwiLCBjdXJyZW50TW9udGhseSlcbn0pO1xuIiwiXG5jb25zdCBjYWxjdWxhdG9yU2xpZGVyID0gKHtcbiAgICBzY2FsZSxcbiAgICBjYWxsYmFjayxcbiAgICBpbml0aWFsVmFsdWUsXG4gIH0pID0+IChjb250YWluZXIpID0+IHtcblxuICAgIHZhciB4ID0gc2NhbGUuY2xhbXAodHJ1ZSk7XG5cbiAgICBjb25zb2xlLmxvZyh4KTtcblxuICAgIHZhciBzbGlkZXIgPSBjb250YWluZXIuYXBwZW5kKFwiZ1wiKVxuICAgICAgICAuYXR0cihcImNsYXNzXCIsIFwic2xpZGVyXCIpICA7XG5cbiAgICBzbGlkZXIuYXBwZW5kKFwibGluZVwiKVxuICAgICAgICAuYXR0cihcImNsYXNzXCIsIFwidHJhY2tcIilcbiAgICAgICAgLmF0dHIoXCJ4MVwiLCB4LnJhbmdlKClbMF0pXG4gICAgICAgIC5hdHRyKFwieDJcIiwgeC5yYW5nZSgpWzFdKVxuICAgICAgLnNlbGVjdChmdW5jdGlvbigpIHsgcmV0dXJuIHRoaXMucGFyZW50Tm9kZS5hcHBlbmRDaGlsZCh0aGlzLmNsb25lTm9kZSh0cnVlKSk7IH0pXG4gICAgICAgIC5hdHRyKFwiY2xhc3NcIiwgXCJ0cmFjay1pbnNldFwiKVxuICAgICAgLnNlbGVjdChmdW5jdGlvbigpIHsgcmV0dXJuIHRoaXMucGFyZW50Tm9kZS5hcHBlbmRDaGlsZCh0aGlzLmNsb25lTm9kZSh0cnVlKSk7IH0pXG4gICAgICAgIC5hdHRyKFwiY2xhc3NcIiwgXCJ0cmFjay1vdmVybGF5XCIpXG4gICAgICAgIC5jYWxsKGQzLmRyYWcoKVxuICAgICAgICAgICAgLm9uKFwic3RhcnQuaW50ZXJydXB0XCIsIGZ1bmN0aW9uKCkgeyBzbGlkZXIuaW50ZXJydXB0KCk7IH0pXG4gICAgICAgICAgICAub24oXCJzdGFydCBkcmFnXCIsIGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICBjb25zb2xlLmxvZyhzY2FsZShkMy5ldmVudC54KSlcbiAgICAgICAgICAgICAgaGFuZGxlLmF0dHIoXCJjeFwiLCBkMy5ldmVudC54KTtcbiAgICAgICAgICAgICAgY2FsbGJhY2soc2NhbGUuaW52ZXJ0KGQzLmV2ZW50LngpKTtcbiAgICAgICAgICAgIH0pKTtcblxuICAgIC8vIHNsaWRlci5pbnNlcnQoXCJnXCIsIFwiLnRyYWNrLW92ZXJsYXlcIilcbiAgICAvLyAgICAgLmF0dHIoXCJjbGFzc1wiLCBcInRpY2tzXCIpXG4gICAgLy8gICAgIC5hdHRyKFwidHJhbnNmb3JtXCIsIFwidHJhbnNsYXRlKDAsXCIgKyAxOCArIFwiKVwiKVxuICAgIC8vICAgLnNlbGVjdEFsbChcInRleHRcIilcbiAgICAvLyAgIC5kYXRhKHgudGlja3MoMTApKVxuICAgIC8vICAgLmVudGVyKCkuYXBwZW5kKFwidGV4dFwiKVxuICAgIC8vICAgICAuYXR0cihcInhcIiwgeClcbiAgICAvLyAgICAgLmF0dHIoXCJ0ZXh0LWFuY2hvclwiLCBcIm1pZGRsZVwiKVxuICAgIC8vICAgICAudGV4dChmdW5jdGlvbihkKSB7IHJldHVybiBkOyB9KTtcblxuICAgIHZhciBoYW5kbGUgPSBzbGlkZXIuaW5zZXJ0KFwiY2lyY2xlXCIsIFwiLnRyYWNrLW92ZXJsYXlcIilcbiAgICAgICAgLmF0dHIoXCJjbGFzc1wiLCBcImhhbmRsZVwiKVxuICAgICAgICAuYXR0cihcInJcIiwgOSk7XG5cbiAgICAvLyBzbGlkZXIudHJhbnNpdGlvbigpIC8vIEdyYXR1aXRvdXMgaW50cm8hXG4gICAgLy8gICAgIC5kdXJhdGlvbig3NTApXG4gICAgLy8gICAgIC50d2VlbihcImh1ZVwiLCBmdW5jdGlvbigpIHtcbiAgICAvLyAgICAgICB2YXIgaSA9IGQzLmludGVycG9sYXRlKDAsIDcwKTtcbiAgICAvLyAgICAgICByZXR1cm4gZnVuY3Rpb24odCkge1xuICAgIC8vICAgICAgICAgaGFuZGxlLmF0dHIoXCJjeFwiLCB4KHQpKTtcbiAgICAvLyAgICAgICAgIGNhbGxiYWNrKGkodCkpO1xuICAgIC8vICAgICAgIH07XG4gICAgLy8gICAgIH0pO1xuXG4gICAgaGFuZGxlLmF0dHIoXCJjeFwiLCB4KGluaXRpYWxWYWx1ZSB8fCA2MDAwMCkpXG4gICAgY2FsbGJhY2soaW5pdGlhbFZhbHVlIHx8IDYwMDAwKVxuXG59O1xuIl19
